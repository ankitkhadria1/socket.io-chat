{"version":3,"sources":["../src/chain.es6"],"names":[],"mappings":";;;;;;;;uBAAiC,WAAW;;qBACX,SAAS;;2BACT,eAAe;;;;0BACf,YAAY;;;;AAEtC,IAAI,GAAG,GAAG,SAAN,GAAG,CAAa,IAAI,EAAE;AAChC,UAAS,IAAI,CAAC,QAAQ,EAAE;AACvB,MAAI,CAAC,wBAAE,UAAU,CAAC,QAAQ,CAAC,IAAI,EAAE,QAAQ,qCAAsB,AAAC,EAAE;AACjE,UAAO,kBAAM,kDAAkD,EAAE,QAAQ,CAAC,CAAC;GAC3E;;AAED,MAAI,CAAC,QAAQ,CAAC,cAAc,yBAAgB,EAAE;AAC7C,SAAM,CAAC,cAAc,CAAC,QAAQ,2BAAkB;AAC/C,cAAU,EAAE,KAAK;AACjB,SAAK,EAAO,IAAI,CAAC,MAAM,GAAG,CAAC;IAC3B,CAAC,CAAC;GACH;;AAED,MAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;EACpB;;AAED,MAAK,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,UAAU,UAAU,EAAE;AACtE,0BAAE,OAAO,CAAC,UAAU,CAAC,GAAG,UAAU,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC;EACpE,CAAC,CAAC;;AAEH,OAAM,CAAC,IAAI,CAAC,CAAC;CACb,CAAC;;;AAEK,IAAI,MAAM,GAAG,SAAT,MAAM,CAAa,IAAI,EAAE;AACnC,KAAI,CAAC,IAAI,CAAC,UAAU,UAAU,EAAE;AAC/B,SAAO,QAAQ,CAAC,UAAU,yBAAgB,EAAE,EAAE,CAAC,CAAC;EAChD,CAAC,CAAA;CACF,CAAC;;;AAEK,IAAI,IAAI,GAAG,SAAP,IAAI,GAAuC;;KAA1B,KAAK,yDAAG,EAAE;KAAE,OAAO,yDAAG,EAAE;;AACnD,QAAO,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM,EAAK;AACvC,MAAI,KAAK,GAAG,CAAC,CAAC;AACd,MAAI,IAAI,GAAI,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,aAAY,CAAC,CAAC,CAAC;;AAErD,WAAS,IAAI,CAAC,KAAK,EAAE;AACpB,OAAI,OAAO,KAAK,KAAK,WAAW,EAAE;AACjC,WAAO,MAAM,CAAC,KAAK,CAAC,CAAC;IACrB;;AAED,OAAI,SAAS,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC;;AAE7B,OAAI,SAAS,EAAE;AACd,SAAK,EAAE,CAAC;AACR,WAAO,SAAS,oCAAsB,GAAG,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS,EAAE,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,GAAG,SAAS,CAAC,KAAK,CAAC,OAAO,EAAE,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC;IAC1I;;AAED,OAAI,KAAK,KAAK,KAAK,CAAC,MAAM,EAAE;AAC3B,WAAO,OAAO,CAAC,KAAK,CAAC,EAAE,EAAE,IAAI,CAAC,CAAC;IAC/B;GACD;;AAED,MAAI,CAAC,wBAAE,OAAO,CAAC,KAAK,CAAC,EAAE;AACtB,qBAAM,oBAAoB,CAAC,CAAC;AAC5B,UAAO,OAAO,CAAC,IAAI,CAAC,CAAC;GACrB;;AAED,MAAI,EAAE,CAAC;EACP,CAAC,CAAC;CACH,CAAC","file":"chain.js","sourcesContent":["import { LABEL_PRIORITY }   from './options';\nimport { debug }            from './debug';\nimport Middleware           from './middlewares';\nimport _                    from 'underscore';\n\nexport let add = function (list) {\n\tfunction push(callback) {\n\t\tif (!_.isFunction(callback) && !(callback instanceof Middleware)) {\n\t\t\treturn debug('add chain middleware: callback is not a function', callback);\n\t\t}\n\n\t\tif (!callback.hasOwnProperty(LABEL_PRIORITY)) {\n\t\t\tObject.defineProperty(callback, LABEL_PRIORITY, {\n\t\t\t\tenumerable: false,\n\t\t\t\tvalue:      list.length + 1\n\t\t\t});\n\t\t}\n\n\t\tlist.push(callback);\n\t}\n\n\tArray.prototype.slice.call(arguments, 1).forEach(function (middleware) {\n\t\t_.isArray(middleware) ? middleware.forEach(push) : push(middleware);\n\t});\n\n\tresort(list);\n};\n\nexport let resort = function (list) {\n\tlist.sort(function (middleware) {\n\t\treturn parseInt(middleware[LABEL_PRIORITY], 10);\n\t})\n};\n\nexport let exec = function (chain = [], context = {}) {\n\treturn new Promise((resolve, reject) => {\n\t\tlet index = 0;\n\t\tlet data  = Array.prototype.slice.call(arguments, 2);\n\n\t\tfunction next(error) {\n\t\t\tif (typeof error !== \"undefined\") {\n\t\t\t\treturn reject(error);\n\t\t\t}\n\n\t\t\tlet chainItem = chain[index];\n\n\t\t\tif (chainItem) {\n\t\t\t\tindex++;\n\t\t\t\treturn chainItem instanceof Middleware ? chainItem.exec.apply(chainItem, data.concat(next)) : chainItem.apply(context, data.concat(next));\n\t\t\t}\n\n\t\t\tif (index === chain.length) {\n\t\t\t\treturn resolve.apply({}, data);\n\t\t\t}\n\t\t}\n\n\t\tif (!_.isArray(chain)) {\n\t\t\tdebug('chain is not array');\n\t\t\treturn resolve(data);\n\t\t}\n\n\t\tnext();\n\t});\n};"]}