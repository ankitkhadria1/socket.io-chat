{"version":3,"sources":["/home/demitriy/work/chat/lib/client.js"],"names":[],"mappings":"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","file":"client-compiled.js","sourcesContent":["'use strict';\n\nvar _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();\n\nvar _get = function get(_x15, _x16, _x17) { var _again = true; _function: while (_again) { desc = parent = getter = undefined; _again = false; var object = _x15,\n    property = _x16,\n    receiver = _x17; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x15 = parent; _x16 = property; _x17 = receiver; _again = true; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) subClass.__proto__ = superClass; }\n\n(function () {\n\t'use strict';\n\n\tvar IO = require('socket.io'),\n\t    db = require('./db'),\n\t    Chat = require('./chat'),\n\t    Message = require('./message'),\n\t    EventEmitter = require('events').EventEmitter,\n\t    util = require('util'),\n\t    _ = require('lodash'),\n\t    sl = Array.prototype.slice;\n\n\t/**\n  * @function socketError\n  * @param {string} event\n  * @param {Error|String} error\n  * @returns {Error}\n  */\n\tfunction socketError(event, error) {\n\t\tvar sError = new Error();\n\n\t\tsError.event = String(event);\n\n\t\tswitch (Object.prototype.toString.call(error)) {\n\t\t\tcase '[object Error]':\n\t\t\t\tsError.message = error.message;\n\t\t\t\tbreak;\n\t\t\tcase '[object String]':\n\t\t\t\tsError.message = error;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tsError.message = String(error);\n\t\t}\n\n\t\treturn sError;\n\t}\n\n\t/**\n  * @function toUpper\n  * @param {string} str\n  * @returns {string}\n  */\n\tfunction toUpper(str) {\n\t\treturn str.replace(/^(\\w)/, function (char) {\n\t\t\treturn char.toUpperCase();\n\t\t});\n\t}\n\n\t/**\n  * @function findSocket\n  * @param io\n  * @param id\n  * @param cb\n  */\n\tfunction findSocket(io, id, cb) {\n\t\tvar ioSockets;\n\n\t\tioSockets = io.sockets.filter(function (socket) {\n\t\t\treturn socket.user && socket.user.equals(id);\n\t\t});\n\n\t\tif (ioSockets[0]) {\n\t\t\tcb(ioSockets[0]);\n\t\t}\n\t}\n\n\t/**\n  * @class ChatClient\n  */\n\n\tvar ChatClient = (function (_EventEmitter) {\n\t\t/**\n   *\n   * @param server Http node.js server\n   * @param options\n   * @param options.collectionChat\n   * @param options.collectionMessages\n   * @param options.EVENTS\n   * @param options.eventPrefix\n   */\n\n\t\tfunction ChatClient(server) {\n\t\t\tvar options = arguments[1] === undefined ? {} : arguments[1];\n\n\t\t\t_classCallCheck(this, ChatClient);\n\n\t\t\t_get(Object.getPrototypeOf(ChatClient.prototype), 'constructor', this).call(this);\n\n\t\t\tvar io,\n\t\t\t    self = this;\n\t\t\tvar collectionChat, collectionChatMessages, EVENTS, eventPrefix;\n\n\t\t\tcollectionChat = options.collectionChat || 'chats';\n\t\t\tcollectionChatMessages = options.collectionMessages || 'chats_messages';\n\n\t\t\teventPrefix = options.eventPrefix || '';\n\n\t\t\tthis.EVENTS = EVENTS = {\n\t\t\t\tAUTHENTICATE: eventPrefix + 'authenticate',\n\t\t\t\tCREATE: eventPrefix + 'create',\n\t\t\t\tENTER: eventPrefix + 'enter',\n\t\t\t\tLEAVE: eventPrefix + 'leave',\n\t\t\t\tADDMEMBER: eventPrefix + 'addMember',\n\t\t\t\tREMOVEMEMBER: eventPrefix + 'removeMember',\n\t\t\t\tNEWMESSAGE: eventPrefix + 'newMessage',\n\t\t\t\tNEWSYSTEMMESSAGE: eventPrefix + 'newSystemMessage',\n\t\t\t\tCHANGETITLE: eventPrefix + 'changeTitle',\n\t\t\t\tLOADLAST: eventPrefix + 'loadLast',\n\t\t\t\tLOADFROM: eventPrefix + 'loadFrom',\n\t\t\t\tLOADAT: eventPrefix + 'loadAt'\n\t\t\t};\n\n\t\t\t_.defaults(EVENTS, options.EVENTS || {});\n\n\t\t\tthis.__validations = {};\n\t\t\tthis.__models = {};\n\n\t\t\tthis.__models.chat = Chat({ collection: collectionChat });\n\t\t\tthis.__models.message = Message({ collection: collectionChatMessages });\n\n\t\t\tthis.io = io = IO(server, { maxHttpBufferSize: 1000 });\n\n\t\t\tio.on('connection', function (socket) {\n\t\t\t\tsocket.on(EVENTS.AUTHENTICATE, function (data) {\n\t\t\t\t\tself.onAuthenticate(this, data);\n\t\t\t\t});\n\n\t\t\t\tsocket.on(EVENTS.CREATE, function (data) {\n\t\t\t\t\tself.authorize(this) && self.onCreate(this, data);\n\t\t\t\t});\n\n\t\t\t\tsocket.on(EVENTS.ENTER, function (data) {\n\t\t\t\t\tself.authorize(this) && self.onEnter(this, data);\n\t\t\t\t});\n\n\t\t\t\tsocket.on(EVENTS.LEAVE, function (data) {\n\t\t\t\t\tself.authorize(this) && self.onLeave(this, data);\n\t\t\t\t});\n\n\t\t\t\tsocket.on(EVENTS.ADDMEMBER, function (data) {\n\t\t\t\t\tself.authorize(this) && self.onAddMember(this, data);\n\t\t\t\t});\n\n\t\t\t\tsocket.on(EVENTS.REMOVEMEMBER, function (data) {\n\t\t\t\t\tself.authorize(this) && self.onRemoveMember(this, data);\n\t\t\t\t});\n\n\t\t\t\tsocket.on(EVENTS.NEWMESSAGE, function (data) {\n\t\t\t\t\tself.authorize(this) && self.onNewMessage(this, data);\n\t\t\t\t});\n\n\t\t\t\tsocket.on(EVENTS.CHANGETITLE, function (data) {\n\t\t\t\t\tself.authorize(this) && self.onChangeTitle(this, data);\n\t\t\t\t});\n\n\t\t\t\tsocket.on(EVENTS.LOADLAST, function (data) {\n\t\t\t\t\tself.authorize(this) && self.onLoadLast(this, data);\n\t\t\t\t});\n\n\t\t\t\tsocket.on(EVENTS.LOADFROM, function (data) {\n\t\t\t\t\tself.authorize(this) && self.onLoadFrom(this, data);\n\t\t\t\t});\n\n\t\t\t\tsocket.on(EVENTS.LOADAT, function (data) {\n\t\t\t\t\tself.authorize(this) && self.onLoadAt(this, data);\n\t\t\t\t});\n\n\t\t\t\tsocket.on('error', function (error) {\n\t\t\t\t\tself.emit('error', this, error.event, error);\n\t\t\t\t});\n\n\t\t\t\tsocket.on('disconnect', function () {\n\t\t\t\t\tsocket.auth = false;\n\t\t\t\t\tself.emit('disconnect', socket);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\t_inherits(ChatClient, _EventEmitter);\n\n\t\t_createClass(ChatClient, [{\n\t\t\tkey: 'eventNames',\n\t\t\tget: function () {\n\t\t\t\treturn this.EVENTS;\n\t\t\t},\n\t\t\tset: function (events) {\n\t\t\t\t_.defaults(this.EVENTS, events);\n\n\t\t\t\treturn this;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'findSockets',\n\t\t\tvalue: function findSockets(ids) {\n\t\t\t\tvar list = [],\n\t\t\t\t    auth = this.authorize;\n\n\t\t\t\tif (!(ids instanceof Array)) {\n\t\t\t\t\tids = [ids];\n\t\t\t\t}\n\n\t\t\t\tlist = this.io.sockets.sockets.filter(function (socket) {\n\t\t\t\t\treturn ids.filter(function (id) {\n\t\t\t\t\t\treturn auth(socket) && socket.user.equals(id);\n\t\t\t\t\t}).length !== 0;\n\t\t\t\t});\n\n\t\t\t\treturn list;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'onAuthenticate',\n\t\t\tvalue: function onAuthenticate(socket) {\n\t\t\t\tvar _this2 = this;\n\n\t\t\t\tvar data = arguments[1] === undefined ? {} : arguments[1];\n\n\t\t\t\tthis.emit(this.EVENTS.AUTHENTICATE, socket, data, function (error) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif (!_this2.authorize(socket)) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t_this2.model('chat').findAllByMember(socket.user).then(function (result) {\n\t\t\t\t\t\tif (!result) {\n\t\t\t\t\t\t\treturn socket.emit(_this2.EVENTS.AUTHENTICATE, { error: { message: 'Неправильный логин/пароль' } });\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsocket.emit('login', { result: { data: result } });\n\t\t\t\t\t})['catch'](function (error) {\n\t\t\t\t\t\treturn socket.emit('error', socketError(_this2.EVENTS.AUTHENTICATE, error));\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'onCreate',\n\t\t\tvalue: function onCreate(socket) {\n\t\t\t\tvar _this3 = this;\n\n\t\t\t\tvar data = arguments[1] === undefined ? {} : arguments[1];\n\n\t\t\t\tthis.create(data, socket.user).then(function (chat) {\n\t\t\t\t\tsocket.emit(_this3.EVENTS.CREATE, { result: { message: 'Чат создан', data: chat.toJSON() } });\n\n\t\t\t\t\t_this3.findSockets(chat.get('members')).forEach(function (socket) {\n\t\t\t\t\t\tsocket.join(String(chat.get('_id')));\n\t\t\t\t\t\tsocket.emit(_this3.EVENTS.ENTER, { result: { data: chat.toJSON() } });\n\t\t\t\t\t});\n\t\t\t\t})['catch'](function (error) {\n\t\t\t\t\treturn socket.emit(_this3.EVENTS.CREATE, { error: { message: error.message } });\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'onEnter',\n\t\t\tvalue: function onEnter(socket) {\n\t\t\t\tvar data = arguments[1] === undefined ? {} : arguments[1];\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'onLeave',\n\t\t\tvalue: function onLeave(socket) {\n\t\t\t\tvar data = arguments[1] === undefined ? {} : arguments[1];\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'onAddMember',\n\t\t\tvalue: function onAddMember(socket) {\n\t\t\t\tvar _this4 = this;\n\n\t\t\t\tvar data = arguments[1] === undefined ? {} : arguments[1];\n\n\t\t\t\tthis.model('chat').findByMember(data.chatId, socket.user).then(function (chat) {\n\t\t\t\t\tif (!chat) {\n\t\t\t\t\t\treturn socket.emit(_this4.EVENTS.ADDMEMBER, { error: { message: 'Чат не найден' } });\n\t\t\t\t\t}\n\n\t\t\t\t\t_this4.addMember(chat, data).then(function (member) {\n\t\t\t\t\t\tif (chat.systemMessages && chat.systemMessages.addMember) {\n\t\t\t\t\t\t\t_this4.onNewMessage(socket, { chatId: chat.get('_id'), text: '' }, 'system');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t_this4.findSockets(chat.get('members')).forEach(function (socket) {\n\t\t\t\t\t\t\tsocket.emit(_this4.EVENTS.ADDMEMBER, {\n\t\t\t\t\t\t\t\tmessage: 'Пользователь добавлен',\n\t\t\t\t\t\t\t\tdata: chat.toJSON()\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t})['catch'](function (error) {\n\t\t\t\t\t\tsocket.emit('error', socketError(_this4.EVENTS.ADDMEMBER, error));\n\t\t\t\t\t});\n\t\t\t\t})['catch'](function (error) {\n\t\t\t\t\tsocket.emit('error', socketError(_this4.EVENTS.ADDMEMBER, error));\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'onRemoveMember',\n\t\t\tvalue: function onRemoveMember(socket) {\n\t\t\t\tvar _this5 = this;\n\n\t\t\t\tvar data = arguments[1] === undefined ? {} : arguments[1];\n\n\t\t\t\tthis.model('chat').findByMember(data.chatId, socket.user).then(function (chat) {\n\t\t\t\t\tif (!chat) {\n\t\t\t\t\t\treturn socket.emit(_this5.EVENTS.REMOVEMEMBER, { error: { message: 'Чат не найден' } });\n\t\t\t\t\t}\n\n\t\t\t\t\t_this5.removeMember(chat, data, function (error, chat, member) {\n\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\treturn socket.emit('error', socketError(_this5.EVENTS.REMOVEMEMBER, error));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t_this5.io['in'](String(chat.get('_id'))).emit(_this5.EVENTS.REMOVEMEMBER, {\n\t\t\t\t\t\t\tmessage: 'Пользователь удален',\n\t\t\t\t\t\t\tdata: chat.toJSON()\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tfindSocket(_this5.io, member, function (socket) {\n\t\t\t\t\t\t\tsocket.join(String(chat.get('_id')));\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t})['catch'](function (error) {\n\t\t\t\t\tsocket.emit('error', socketError(_this5.EVENTS.REMOVEMEMBER, error));\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'onNewMessage',\n\t\t\tvalue: function onNewMessage(socket) {\n\t\t\t\tvar _this6 = this;\n\n\t\t\t\tvar data = arguments[1] === undefined ? {} : arguments[1];\n\t\t\t\tvar type = arguments[2] === undefined ? '' : arguments[2];\n\n\t\t\t\tthis.model('chat').findByMember(data.chatId, socket.user).then(function (chat) {\n\t\t\t\t\tif (!chat) {\n\t\t\t\t\t\treturn socket.emit(_this6.EVENTS.NEWMESSAGE, { error: { message: 'Чат не найден' } });\n\t\t\t\t\t}\n\n\t\t\t\t\treturn _this6.newMessage(chat, data, socket.user);\n\t\t\t\t}).then(function (message) {\n\t\t\t\t\t_this6.findSockets(message.get('receivers')).forEach(function (socket) {\n\t\t\t\t\t\tsocket.emit(_this6.EVENTS.NEWMESSAGE, {\n\t\t\t\t\t\t\tresult: {\n\t\t\t\t\t\t\t\tmessage: 'Новое сообщение',\n\t\t\t\t\t\t\t\tdata: message.toJSON()\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t})['catch'](function (error) {\n\t\t\t\t\tsocket.emit('error', socketError(_this6.EVENTS.NEWMESSAGE, error));\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'onNewSystemMessage',\n\t\t\tvalue: function onNewSystemMessage(socket) {\n\t\t\t\tvar _this7 = this;\n\n\t\t\t\tvar data = arguments[1] === undefined ? {} : arguments[1];\n\n\t\t\t\tthis.model('chat').findByMember(data.chatId, socket.user).then(function (chat) {\n\t\t\t\t\tif (!chat) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn _this7.newSystemMessage(chat, data, socket.user);\n\t\t\t\t}).then(function () {});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'onLoadLast',\n\t\t\tvalue: function onLoadLast(socket) {\n\t\t\t\tvar _this8 = this;\n\n\t\t\t\tvar data = arguments[1] === undefined ? {} : arguments[1];\n\n\t\t\t\tthis.messagesFindLast(data.chatId, socket.user, data.count).then(function (messages) {\n\t\t\t\t\tsocket.emit(_this8.EVENTS.LOADLAST, {\n\t\t\t\t\t\tresult: {\n\t\t\t\t\t\t\tchatId: data.chatId,\n\t\t\t\t\t\t\tdata: messages\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t})['catch'](function (error) {\n\t\t\t\t\tsocket.emit('error', socketError(_this8.EVENTS.LOADLAST, error));\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'onLoadFrom',\n\t\t\tvalue: function onLoadFrom(socket) {\n\t\t\t\tvar _this9 = this;\n\n\t\t\t\tvar data = arguments[1] === undefined ? {} : arguments[1];\n\n\t\t\t\tthis.messagesFindFrom(data.chatId, data.messageId, socket.user, data.count).then(function (messages) {\n\t\t\t\t\tsocket.emit(_this9.EVENTS.LOADFROM, {\n\t\t\t\t\t\tresult: {\n\t\t\t\t\t\t\tchatId: data.chatId,\n\t\t\t\t\t\t\tdata: messages\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t})['catch'](function (error) {\n\t\t\t\t\tsocket.emit('error', socketError(_this9.EVENTS.LOADFROM, error));\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'onLoadAt',\n\t\t\tvalue: function onLoadAt(socket) {\n\t\t\t\tvar _this10 = this;\n\n\t\t\t\tvar data = arguments[1] === undefined ? {} : arguments[1];\n\n\t\t\t\tthis.messagesFindAt(data.chatId, data.messageId, socket.user, data.count).then(function (messages) {\n\t\t\t\t\tsocket.emit(_this10.EVENTS.LOADAT, {\n\t\t\t\t\t\tresult: {\n\t\t\t\t\t\t\tchatId: data.chatId,\n\t\t\t\t\t\t\tdata: messages\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t})['catch'](function (error) {\n\t\t\t\t\tsocket.emit('error', socketError(_this10.EVENTS.LOADAT, error));\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'onChangeTitle',\n\t\t\tvalue: function onChangeTitle(socket) {\n\t\t\t\tvar data = arguments[1] === undefined ? {} : arguments[1];\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'authorize',\n\n\t\t\t/**\n    *\n    * @param socket\n    * @returns {boolean}\n    */\n\t\t\tvalue: function authorize(socket) {\n\t\t\t\treturn !!socket.auth;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'model',\n\n\t\t\t/**\n    *\n    * @param {string} name\n    * @returns {*}\n    */\n\t\t\tvalue: function model(name) {\n\t\t\t\treturn this.__models[name];\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'use',\n\n\t\t\t/**\n    *\n    * @param {function}    cb\n    * @returns {ChatClient}\n    */\n\t\t\tvalue: function use(cb) {\n\t\t\t\tthis.io.use(cb);\n\n\t\t\t\treturn this;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'validate',\n\n\t\t\t/**\n    *\n    * @param {string}      path\n    * @param {function}    cb\n    * @returns {ChatClient}\n    */\n\t\t\tvalue: function validate(path, cb) {\n\t\t\t\tpath = path || 'default';\n\t\t\t\tcb = cb || function () {};\n\n\t\t\t\tif (!this.__validations[path]) {\n\t\t\t\t\tthis.__validations[path] = [];\n\t\t\t\t}\n\n\t\t\t\tthis.__validations[path].push(cb);\n\n\t\t\t\treturn this;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'create',\n\n\t\t\t/**\n    *\n    * @param {object}      data\n    * @param {ObjectId}    creator\n    */\n\t\t\tvalue: function create(data, creator) {\n\t\t\t\tvar _this11 = this;\n\n\t\t\t\tvar chat = new (this.model('chat'))(data);\n\n\t\t\t\tchat.setCreator(creator);\n\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\t_this11._validatePath(_this11.EVENTS.CREATE, { chat: chat }, function (error) {\n\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\treturn reject(error);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tchat.save(function (error, result) {\n\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\treturn reject(error);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tresolve(chat);\n\t\t\t\t\t\t\t_this11.emit(_this11.EVENTS.CREATE, chat);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'addMember',\n\n\t\t\t/**\n    *\n    * @param {Chat}        chat\n    * @param {ObjectId}    member\n    */\n\t\t\tvalue: function addMember(chat, member) {\n\t\t\t\tvar _this12 = this;\n\n\t\t\t\tchat.addMember(member);\n\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\t_this12._validatePath(_this12.EVENTS.ADDMEMBER, { chat: chat, member: member }, function (error) {\n\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\treturn reject(error);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tchat.update(function (error) {\n\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\treturn reject(error);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tresolve(member);\n\t\t\t\t\t\t\t_this12.emit(_this12.EVENTS.ADDMEMBER, chat, member);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'removeMember',\n\n\t\t\t/**\n    *\n    * @param {Chat}        chat\n    * @param {ObjectId}    member\n    */\n\t\t\tvalue: function removeMember(chat, member) {\n\t\t\t\tvar _this13 = this;\n\n\t\t\t\tchat.removeMember(member);\n\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\t_this13._validatePath(_this13.EVENTS.REMOVEMEMBER, { chat: chat, member: member }, function (error) {\n\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\treturn reject(error);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tchat.update(function (error) {\n\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\treturn reject(error);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tresolve(chat, member);\n\t\t\t\t\t\t\t_this13.emit(_this13.EVENTS.REMOVEMEMBER, chat, member);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'newMessage',\n\n\t\t\t/**\n    *\n    * @param {Chat}        chat\n    * @param {object}      messageData\n    * @param {ObjectId}    creator\n    */\n\t\t\tvalue: function newMessage(chat, messageData, creator) {\n\t\t\t\tvar _this14 = this;\n\n\t\t\t\tvar self = this,\n\t\t\t\t    message = null;\n\n\t\t\t\tmessage = new (self.model('message'))(messageData);\n\t\t\t\tmessage.setChat(chat);\n\t\t\t\tmessage.setAuthor(creator);\n\t\t\t\tmessage.setReceivers(chat.members);\n\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\t_this14._validatePath(_this14.EVENTS.NEWMESSAGE, { chat: chat, message: message }, function (error) {\n\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\treturn reject(error);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tmessage.save(function (error) {\n\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\treturn reject(error);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tresolve(message);\n\n\t\t\t\t\t\t\t_this14.emit(_this14.EVENTS.NEWMESSAGE, chat, message);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'newSystemMessage',\n\t\t\tvalue: function newSystemMessage(chat, messageData, type) {\n\t\t\t\tvar _this15 = this;\n\n\t\t\t\tvar message;\n\n\t\t\t\tmessage = new (this.model('message'))(messageData);\n\t\t\t\tmessage.setChat(chat);\n\t\t\t\tmessage.setSystemAuthor();\n\t\t\t\tmessage.setReceivers(chat.members);\n\n\t\t\t\tmessage.set('type', type);\n\t\t\t\tmessage.set('system', messageData);\n\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\t_this15._validatePath(_this15.EVENTS.NEWSYSTEMMESSAGE, { chat: chat, message: message }, function (error) {\n\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\treturn reject(error);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tmessage.save(function (error) {\n\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\treturn reject(error);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tresolve(message);\n\n\t\t\t\t\t\t\t_this15.emit(_this15.EVENTS.NEWSYSTEMMESSAGE, chat, message);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'messagesFindLast',\n\t\t\tvalue: function messagesFindLast(chatId, user, count) {\n\t\t\t\tvar _this16 = this;\n\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\t_this16._validatePath(_this16.EVENTS.LOADLAST, { chatId: chatId, user: user, count: count }, function (error) {\n\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn _this16.model('message').findLast(chatId, user, count).then(resolve, reject);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'messagesFindFrom',\n\t\t\tvalue: function messagesFindFrom(chatId, messageId, user, count) {\n\t\t\t\tvar _this17 = this;\n\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\t_this17._validatePath(_this17.EVENTS.LOADFROM, { chatId: chatId, messageId: messageId, user: user, count: count }, function (error) {\n\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn _this17.model('message').findFrom(chatId, messageId, user, count).then(resolve, reject);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'messagesFindAt',\n\t\t\tvalue: function messagesFindAt(chatId, messageId, user, count) {\n\t\t\t\tvar _this18 = this;\n\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\t_this18._validatePath(_this18.EVENTS.LOADAT, { chatId: chatId, messageId: messageId, user: user, count: count }, function (error) {\n\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\treject(error);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn _this18.model('message').findAt(chatId, messageId, user, count).then(resolve, reject);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: '_validatePath',\n\t\t\tvalue: function _validatePath(path, socket, data) {\n\t\t\t\tvar validations = this.__validations[path],\n\t\t\t\t    index = 0,\n\t\t\t\t    cb = sl.call(arguments, -1)[0];\n\n\t\t\t\tif (!validations) {\n\t\t\t\t\tvalidations = [];\n\t\t\t\t}\n\n\t\t\t\tfunction next(error) {\n\t\t\t\t\tif (typeof error !== 'undefined') {\n\t\t\t\t\t\treturn cb(error);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar validation = validations[index];\n\n\t\t\t\t\tif (validation) {\n\t\t\t\t\t\tindex++;\n\t\t\t\t\t\treturn validation(socket, data, next);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (index === validations.length) {\n\t\t\t\t\t\treturn cb();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tnext();\n\t\t\t}\n\t\t}]);\n\n\t\treturn ChatClient;\n\t})(EventEmitter);\n\n\tmodule.exports = ChatClient;\n})();"]}