{"version":3,"sources":["../src/clientSocket.es6"],"names":[],"mappings":"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","file":"src/clientSocket.es6","sourcesContent":["(function () {\n\t\"use strict\";\n\n\tvar ClientError  = require('./error');\n\n\tfunction catchErrorMessage(error) {\n\t\tswitch (error.type) {\n\t\t\tcase 'validation':\n\t\t\tcase 'client':\n\t\t\t\treturn error.message;\n\t\t\tdefault:\n\t\t\t\treturn 'Unknown error';\n\t\t}\n\t}\n\n\t/**\n\t * @function socketError\n\t * @param {String} event\n\t * @param {Error|String} error\n\t * @returns {Error}\n\t */\n\tfunction socketError(event, error) {\n\t\tvar sError = new Error();\n\n\t\tsError.event = String(event);\n\n\t\tswitch (Object.prototype.toString.call(error)) {\n\t\t\tcase '[object Error]':\n\t\t\t\tsError.message = error.message;\n\t\t\t\tbreak;\n\t\t\tcase '[object String]':\n\t\t\t\tsError.message = error;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tsError.message = String(error);\n\t\t}\n\n\t\treturn sError;\n\t}\n\n\tclass ClientSocket {\n\t\tonAuthenticate(client, socket, data = {}) {\n\t\t\tclient.emit(client.EVENTS.AUTHENTICATE, socket, data, (error) => {\n\t\t\t\tif (error) {\n\t\t\t\t\treturn socket.emitError('login', { message: error.message || error });\n\t\t\t\t}\n\n\t\t\t\tif (!client.authorize(socket)) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tclient.__members.add(socket.user, socket);\n\n\t\t\t\tsocket.emitResult('login', { user: socket.user, data: [] });\n\t\t\t});\n\t\t}\n\n\t\tonCreate(client, socket, data = {}) {\n\t\t\tclient.create(data, socket.user)\n\t\t\t\t.then((chat) => {\n\t\t\t\t\tsocket.emitResult(client.EVENTS.CREATE, { message: 'Chat created', data: chat.toJSON() });\n\n\t\t\t\t\tclient.__rooms.addMembers(\n\t\t\t\t\t\tchat.get('_id'),\n\t\t\t\t\t\tclient.__members.get(chat.get('members'))\n\t\t\t\t\t);\n\n\t\t\t\t\tclient.__members.get(chat.get('members'))\n\t\t\t\t\t\t.forEach((socket) => {\n\t\t\t\t\t\t\tsocket.emitResult(client.EVENTS.ENTER, { data: chat.toJSON() });\n\t\t\t\t\t\t});\n\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\treturn socket.emit(client.EVENTS.CREATE, { error: { message: error.message } });\n\t\t\t\t});\n\t\t}\n\n\t\tonLeave(client, socket, data = {}) {\n\t\t\tvar chat;\n\n\t\t\tclient.model('chat').findById(data.chatId)\n\t\t\t\t.then((result) => {\n\t\t\t\t\tif (!(chat = result)) {\n\t\t\t\t\t\tthrow new ClientError('Chat not found');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn client.leave(chat, socket.user)\n\t\t\t\t})\n\t\t\t\t.then((member) => {\n\t\t\t\t\tclient.__rooms.removeMember(chat.get('_id'), member);\n\n\t\t\t\t\tlet receivers = chat.get('members').concat(member),\n\t\t\t\t\t\tsockets   = client.__members.get(receivers);\n\n\t\t\t\t\tif (chat.systemMessages && chat.systemMessages.leaveMember) {\n\t\t\t\t\t\tclient.newSystemMessage(chat, { whoLeaved: member })\n\t\t\t\t\t\t\t.then((message) => {\n\t\t\t\t\t\t\t\tsockets.forEach((socket) => {\n\t\t\t\t\t\t\t\t\tsocket.emitResult(client.EVENTS.NEWMESSAGE, {\n\t\t\t\t\t\t\t\t\t\tmessage: 'New system message',\n\t\t\t\t\t\t\t\t\t\tdata:    message.toJSON()\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t})\n\t\t\t\t\t}\n\n\t\t\t\t\tsockets.forEach((socket) => {\n\t\t\t\t\t\tsocket.emitResult(client.EVENTS.LEAVE, { message: 'The member leaved', data: member });\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tsocket.emitError(client.EVENTS.LEAVE, { message: catchErrorMessage(error) });\n\t\t\t\t});\n\t\t}\n\n\t\tonAddMember(client, socket, data = {}) {\n\t\t\tvar chat, countBefore, countAfter;\n\n\t\t\tclient.model('chat').findById(data.chatId)\n\t\t\t\t.then((result) => {\n\t\t\t\t\tif (!(chat = result)) {\n\t\t\t\t\t\tthrow new ClientError('Chat not found');\n\t\t\t\t\t}\n\n\t\t\t\t\tcountBefore = chat.get('members').length;\n\n\t\t\t\t\treturn client.addMember(chat, data.member, socket.user)\n\t\t\t\t})\n\t\t\t\t.then((member) => {\n\t\t\t\t\tcountAfter = chat.get('members').length;\n\n\t\t\t\t\tif (countBefore === countAfter) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\n\t\t\t\t\tlet receivers = chat.get('members'),\n\t\t\t\t\t\tsockets   = client.__members.get(receivers);\n\n\t\t\t\t\tclient.__rooms.addMembers(chat.get('_id'), member);\n\n\t\t\t\t\tif (chat.systemMessages && chat.systemMessages.addMember) {\n\t\t\t\t\t\tclient.newSystemMessage(chat, { whoAdded: socket.user, whomAdded: member })\n\t\t\t\t\t\t\t.then((message) => {\n\t\t\t\t\t\t\t\tsockets.forEach((socket) => {\n\t\t\t\t\t\t\t\t\tsocket.emitResult(client.EVENTS.NEWMESSAGE, {\n\t\t\t\t\t\t\t\t\t\tmessage: 'New system message',\n\t\t\t\t\t\t\t\t\t\tdata:    message.toJSON()\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t})\n\t\t\t\t\t}\n\n\t\t\t\t\tsockets.forEach((socket) => {\n\t\t\t\t\t\tsocket.emitResult(client.EVENTS.ADDMEMBER, { message: 'The member added', data: member });\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tsocket.emitError(client.EVENTS.ADDMEMBER, { message: catchErrorMessage(error) });\n\t\t\t\t});\n\t\t}\n\n\t\tonRemoveMember(client, socket, data = {}) {\n\t\t\tvar chat, countBefore, countAfter;\n\n\t\t\tclient.model('chat').findById(data.chatId)\n\t\t\t\t.then((result) => {\n\t\t\t\t\tif (!(chat = result)) {\n\t\t\t\t\t\tthrow new ClientError('Chat not found');\n\t\t\t\t\t}\n\n\t\t\t\t\tcountBefore = chat.get('members').length;\n\n\t\t\t\t\treturn client.removeMember(chat, data.member, socket.user)\n\t\t\t\t})\n\t\t\t\t.then((member) => {\n\t\t\t\t\tcountAfter = chat.get('members').length;\n\n\t\t\t\t\tif (countBefore === countAfter) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tclient.__rooms.removeMember(chat.get('_id'), member);\n\n\t\t\t\t\tlet receivers = chat.get('members').concat(member),\n\t\t\t\t\t\tsockets   = client.__members.get(receivers);\n\n\t\t\t\t\tif (chat.systemMessages && chat.systemMessages.removeMember) {\n\t\t\t\t\t\tclient.newSystemMessage(chat, { whoRemove: socket.user, whomRemove: member })\n\t\t\t\t\t\t\t.then((message) => {\n\t\t\t\t\t\t\t\tsockets.forEach((socket) => {\n\t\t\t\t\t\t\t\t\tsocket.emitResult(client.EVENTS.NEWMESSAGE, {\n\t\t\t\t\t\t\t\t\t\tmessage: 'New system message',\n\t\t\t\t\t\t\t\t\t\tdata:    message.toJSON()\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tsockets.forEach((socket) => {\n\t\t\t\t\t\tsocket.emitResult(client.EVENTS.REMOVEMEMBER, { message: 'The member removed', data: member });\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tsocket.emitError(client.EVENTS.REMOVEMEMBER, { message: catchErrorMessage(error) });\n\t\t\t\t});\n\t\t}\n\n\t\tonNewMessage(client, socket, data = {}) {\n\t\t\tvar chat;\n\n\t\t\tclient.model('chat').findById(data.chatId)\n\t\t\t\t.then((result) => {\n\t\t\t\t\tif (!(chat = result)) {\n\t\t\t\t\t\tthrow new ClientError('Chat not found');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn client.newMessage(chat, data, socket.user);\n\t\t\t\t})\n\t\t\t\t.then((message) => {\n\t\t\t\t\tclient.__members.get(chat.get('members'))\n\t\t\t\t\t\t.forEach((socket) => {\n\t\t\t\t\t\t\tsocket.emitResult(client.EVENTS.NEWMESSAGE, {\n\t\t\t\t\t\t\t\tmessage: 'New message',\n\t\t\t\t\t\t\t\tdata:    message.toJSON()\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tif (catchErrorMessage(error) === 'Unknown error') {\n\t\t\t\t\t\tconsole.log(error.stack);\n\t\t\t\t\t}\n\n\t\t\t\t\tsocket.emitError(client.EVENTS.NEWMESSAGE, { message: catchErrorMessage(error) });\n\t\t\t\t});\n\t\t}\n\n\t\tonLoadLast(client, socket, data = {}) {\n\t\t\tclient.findLastMessages(data.chatId, socket.user, data.count)\n\t\t\t\t.then((messages) => {\n\t\t\t\t\tsocket.emit(client.EVENTS.FINDMESSAGESLAST, {\n\t\t\t\t\t\tresult: {\n\t\t\t\t\t\t\tchatId: data.chatId,\n\t\t\t\t\t\t\tdata:   messages\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tsocket.emit('error', socketError(client.EVENTS.FINDMESSAGESLAST, error));\n\t\t\t\t});\n\t\t}\n\n\t\tonLoadFrom(client, socket, data = {}) {\n\t\t\tclient.findFromMessages(data.chatId, data.messageId, socket.user, data.count)\n\t\t\t\t.then((messages) => {\n\t\t\t\t\tsocket.emit(client.EVENTS.FINDMESSAGESFROM, {\n\t\t\t\t\t\tresult: {\n\t\t\t\t\t\t\tchatId: data.chatId,\n\t\t\t\t\t\t\tdata:   messages\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tsocket.emit('error', socketError(client.EVENTS.FINDMESSAGESFROM, error));\n\t\t\t\t});\n\t\t}\n\n\t\tonLoadAt(client, socket, data = {}) {\n\t\t\tclient.findAtMessages(data.chatId, data.messageId, socket.user, data.count)\n\t\t\t\t.then((messages) => {\n\t\t\t\t\tsocket.emitResult(client.EVENTS.FINDMESSAGESAT, { chatId: data.chatId, data: messages });\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tsocket.emit('error', socketError(client.EVENTS.FINDMESSAGESAT, error));\n\t\t\t\t});\n\t\t}\n\n\t\tonFindChat(client, socket, data = {}) {\n\t\t\tclient.findChatById(socket.user, data.chatId)\n\t\t\t\t.then((chat) => {\n\t\t\t\t\tsocket.emitResult(client.EVENTS.FINDCHAT, { data: chat });\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tsocket.emit('error', socketError(client.EVENTS.FINDCHAT, error));\n\t\t\t\t});\n\t\t}\n\n\t\tonFindChats(client, socket, data = {}) {\n\t\t\tclient.findChats(socket.user, data.count)\n\t\t\t\t.then((chats) => {\n\t\t\t\t\tsocket.emitResult(client.EVENTS.FINDCHATS, { data: chats });\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tsocket.emit('error', socketError(client.EVENTS.FINDCHATS, error));\n\t\t\t\t});\n\t\t}\n\n\t\tonChangeTitle(client, socket, data = {}) {\n\t\t\tvar oldTitle;\n\n\t\t\tclient.model('chat').findById(data.chatId)\n\t\t\t\t.then((chat) => {\n\t\t\t\t\tif (!chat) {\n\t\t\t\t\t\tthrow new ClientError('Chat not found');\n\t\t\t\t\t}\n\n\t\t\t\t\toldTitle = String(chat.get('title'));\n\n\t\t\t\t\treturn client.changeTitle(chat, data.title, socket.user)\n\t\t\t\t})\n\t\t\t\t.then((chat) => {\n\t\t\t\t\tlet receivers = chat.get('members'),\n\t\t\t\t\t\tsockets   = client.__members.get(receivers);\n\n\t\t\t\t\tif (chat.systemMessages && chat.systemMessages.changeTitle) {\n\t\t\t\t\t\tclient.newSystemMessage(chat, {\n\t\t\t\t\t\t\tchanged: socket.user, oldTitle: oldTitle, newTitle: chat.get('title')\n\t\t\t\t\t\t}).then((message) => {\n\t\t\t\t\t\t\tsockets.forEach((socket) => {\n\t\t\t\t\t\t\t\tsocket.emitResult(client.EVENTS.NEWMESSAGE, {\n\t\t\t\t\t\t\t\t\tmessage: 'New system message',\n\t\t\t\t\t\t\t\t\tdata:    message.toJSON()\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\n\t\t\t\t\tsockets.forEach((socket) => {\n\t\t\t\t\t\tsocket.emitResult(client.EVENTS.CHANGETITLE, {\n\t\t\t\t\t\t\tmessage: 'Title changed',\n\t\t\t\t\t\t\tdata:    message.toJSON()\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tsocket.emitError(client.EVENTS.CHANGETITLE, { message: catchErrorMessage(error) });\n\t\t\t\t});\n\t\t}\n\t}\n\n\tmodule.exports = new ClientSocket;\n}());"]}