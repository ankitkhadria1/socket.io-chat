{"version":3,"sources":["../../src/db/cursor.es6"],"names":[],"mappings":"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","file":"cursor.js","sourcesContent":["function castSortValue(value) {\n\tvar _v = parseInt(value, 10);\n\n\treturn (_v !== 1 && _v !== -1) ? 1 : _v;\n}\n\nfunction castSchemaValue(type, value) {\n\tswitch (type) {\n\t\tcase 'string':\n\t\t\treturn String(value);\n\t\tcase 'number':\n\t\t\treturn Number(value);\n\t\tcase 'date-time':\n\t\t\treturn new Date(value) || null;\n\t\tcase 'object':\n\t\t\treturn value;\n\t\tdefault:\n\t\t\treturn String(value);\n\t}\n}\n\n\nclass Cursor {\n\tconstructor(queryResolver) {\n\t\tthis.queryResolver = queryResolver;\n\t}\n}\n\n\nexport class CursorFind extends Cursor {\n\tconstructor(queryResolver) {\n\t\tsuper(queryResolver);\n\t}\n\n\tfind(query, select) {\n\t\tthis.__query = query;\n\t\tthis.select(select);\n\n\t\treturn this;\n\t}\n\n\tselect(select = {}) {\n\t\tthis.__select = select;\n\t}\n\n\tsort(sort = {}) {\n\t\tthis.__sort = sort;\n\n\t\treturn this;\n\t}\n\n\tlimit(limit) {\n\t\tthis.__limit = Math.abs(limit);\n\n\t\treturn this;\n\t}\n\n\tskip(skip) {\n\t\tthis.__skip = Math.abs(skip);\n\n\t\treturn this;\n\t}\n\n\tnext(id) {\n\t\tthis.__next = id;\n\t}\n\n\tprev(id) {\n\t\tthis.__prev = id;\n\t}\n\n\tbindCriteria(criteria = {}) {\n\t\tcriteria.limit && ( this.__criteria.limit = Math.abs(criteria.limit) );\n\t\tcriteria.next && ( this.__criteria.next = criteria.next );\n\t\tcriteria.prev && ( this.__criteria.prev = criteria.prev );\n\n\t\tif (criteria.filter) {\n\t\t\tif (!_.isObject(criteria.filter)) {\n\t\t\t\tthis.__criteria.filter = {};\n\t\t\t}\n\n\t\t\tthis.__criteria.filter = criteria.filter;\n\n\t\t\tObject.keys(this.__criteria.filter).forEach((key) => {\n\t\t\t\tif (!this.__query.hasOwnProperty(key) && this.queryResolver.Model.schema().properties.hasOwnProperty(key)) {\n\t\t\t\t\tthis.__query[key] = castSchemaValue(this.queryResolver.Model.schema().properties[key].type, this.__criteria.filter[key]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (criteria.limit && typeof this.__limit === 'undefined') {\n\t\t\tthis.limit(criteria.limit);\n\t\t}\n\n\t\tif (criteria.skip && typeof this.__skip === 'undefined') {\n\t\t\tthis.skip(criteria.skip);\n\t\t}\n\n\t\tif (criteria.sort) {\n\t\t\tif (!_.isObject(criteria.sort)) {\n\t\t\t\tcriteria.sort = {};\n\t\t\t}\n\n\t\t\tthis.__criteria.sort = criteria.sort;\n\n\t\t\tObject.keys(this.__criteria.sort).forEach((key) => {\n\t\t\t\tif (!this.sort.hasOwnProperty(key) && this.schema.properties.hasOwnProperty(key)) {\n\t\t\t\t\tthis.sort[key] = castSortValue(this.__criteria.sort[key]);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tmerge(query = {}) {\n\t\tthis.__query = deepExtend(this.__query, query);\n\n\t\treturn this;\n\t}\n\n\texec(options) {\n\t\treturn this.queryResolver.provider.find(this, options);\n\t}\n}\n\nexport class CursorFindOne extends Cursor {\n\tconstructor(queryResolver) {\n\t\tsuper(queryResolver);\n\t}\n\n\texec(options = {}) {\n\t\treturn this.queryResolver.provider.findOne(this, options);\n\t}\n}\n\nexport class CursorInsert extends Cursor {\n\tconstructor(queryResolver) {\n\t\tsuper(queryResolver);\n\n\t\tthis.__data = {};\n\t}\n\n\tinsert(data = {}) {\n\t\tthis.__data = data;\n\t\treturn this;\n\t}\n\n\texec(options = {}) {\n\t\treturn this.queryResolver.provider.insert(this, options);\n\t}\n}\n\nexport class CursorUpdate extends Cursor {\n\tconstructor(queryResolver) {\n\t\tsuper(queryResolver);\n\n\t\tthis.__query       = {};\n\t\tthis.__updateQuery = {};\n\t\tthis.__options     = {};\n\t}\n\n\tupdate(query = {}, updateQuery = {}, options = {}) {\n\t\tthis.__query       = query;\n\t\tthis.__updateQuery = updateQuery;\n\t\tthis.__options     = options;\n\n\t\treturn this;\n\t}\n\n\texec(options = {}) {\n\t\treturn this.queryResolver.provider.update(this, options);\n\t}\n}\n\nexport class CursorRemove extends Cursor {\n\tconstructor(queryResolver) {\n\t\tsuper(queryResolver);\n\n\t\tthis.__query = {};\n\t}\n\n\tremove(query = {}) {\n\t\tthis.__query = query;\n\n\t\treturn this;\n\t}\n\n\texec(options = {}) {\n\t\treturn this.queryResolver.provider.remove(this, options);\n\t}\n}"]}