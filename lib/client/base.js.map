{"version":3,"sources":["../../src/client/base.es6"],"names":[],"mappings":"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","file":"base.js","sourcesContent":["import IO                 from 'socket.io';\nimport EventEmitter       from 'events';\nimport _                  from 'underscore';\nimport deepExtend         from 'deep-extend';\nimport { debug }          from '../debug';\nimport ChatModel          from '../models/chat';\nimport MessageModel       from '../models/message';\nimport Members            from '../members';\nimport Rooms              from '../rooms';\nimport Memory             from '../memory';\nimport Db                 from '../db/index';\nimport Component          from '../component/index';\nimport RespondComponent   from '../component/respond';\nimport JoinQueueComponent from '../component/joinQueue';\nimport * as chain         from '../chain';\nimport * as middleWares   from '../middlewares';\nimport * as OPTION        from '../options';\nimport * as EVENT         from '../events';\n\nrequire('source-map-support').install();\n\nvar typeOf = function (object) {\n\treturn Object.prototype.toString.call(object).replace(/\\[object\\s(\\w+)\\]/, '$1');\n};\n\nconst IO_CONNECTION = 'connection';\nconst SOCKET_USER   = 'user';\n\nclass BaseClient extends EventEmitter {\n\tconstructor(server, options = {}) {\n\t\tsuper();\n\n\t\tif (!server) {\n\t\t\tthrow new Error('first argument required `http` server');\n\t\t}\n\n\t\tif (!options.db) {\n\t\t\tthrow new Error('options required `db` section');\n\t\t}\n\n\t\tif (!options.db.connect) {\n\t\t\tthrow new Error('options.db required `connect`');\n\t\t}\n\n\t\tif (!options.db.provider) {\n\t\t\tthrow new Error('options.db required `provider` (mongodb)');\n\t\t}\n\n\t\tObject.defineProperties(this, {\n\t\t\tmiddleware: {\n\t\t\t\tenumerable: false,\n\t\t\t\twritable:   true,\n\t\t\t\tvalue:      []\n\t\t\t},\n\t\t\toptions:    {\n\t\t\t\tenumerable: false,\n\t\t\t\twritable:   true,\n\t\t\t\tvalue:      _.clone(options)\n\t\t\t},\n\t\t\tio:         {\n\t\t\t\tenumerable: false,\n\t\t\t\twritable:   true,\n\t\t\t\tvalue:      IO(server, deepExtend({ maxHttpBufferSize: 1000 }, options[OPTION.IO] || {}))\n\t\t\t},\n\t\t\tEVENTS:     {\n\t\t\t\tenumerable: false,\n\t\t\t\twritable:   true,\n\t\t\t\tvalue:      Object.create(null)\n\t\t\t},\n\t\t\tcomponents: {\n\t\t\t\tenumerable: false,\n\t\t\t\tvalue:      {\n\t\t\t\t\tRespond:   null,\n\t\t\t\t\tjoinQueue: null,\n\t\t\t\t\tModel:     null\n\t\t\t\t}\n\t\t\t},\n\t\t\t//rooms:        {\n\t\t\t//\tenumerable: false,\n\t\t\t//\twritable:   true,\n\t\t\t//\tvalue:      new Rooms()\n\t\t\t//},\n\t\t\tmembers:    {\n\t\t\t\tenumerable: false,\n\t\t\t\twritable:   true,\n\t\t\t\tvalue:      new Members()\n\t\t\t}\n\t\t});\n\t}\n\n\tinitialize() {\n\t\tthis.emit('pre-initialize');\n\n\t\tthis.db = new Db(this.options.db);\n\n\t\tthis.initializeComponents();\n\n\t\t//this.io.on(IO_CONNECTION, (socket) => {});\n\n\t\tlet _client           = this;\n\t\tlet wrapEventCallback = function (event, socket, data) {\n\t\t\t_client.invoke(event, socket, data);\n\t\t};\n\n\t\tthis.namespace = this.io.of('/' + this.options[OPTION.NAMESPACE]);\n\t\tthis.namespace.on(EVENT.IO_CONNECTION, (socket) => {\n\t\t\tfor (let eventName in this.EVENTS) {\n\t\t\t\tsocket.on(eventName, (function (event) {\n\t\t\t\t\treturn function (data = {}) {\n\t\t\t\t\t\twrapEventCallback(event, socket, data)\n\t\t\t\t\t};\n\t\t\t\t}(eventName)));\n\t\t\t}\n\n\t\t\tsocket.on(EVENT.ERROR, function (error) {\n\t\t\t\tconsole.log(error.stack);\n\t\t\t});\n\n\t\t\tsocket.on(EVENT.OPTIONS, () => {\n\t\t\t\tlet events = {};\n\n\t\t\t\tfor (let eventName in this.EVENTS) {\n\t\t\t\t\tevents[this.revertEventName(eventName)] = eventName;\n\t\t\t\t}\n\n\t\t\t\tsocket.emit(EVENT.OPTIONS, { events });\n\t\t\t});\n\n\t\t\tsocket.on('disconnect', () => {\n\t\t\t\tthis.members.remove(socket.user, socket);\n\t\t\t\tthis.logoutSocket(socket);\n\t\t\t});\n\t\t});\n\n\t\tthis.__models = {\n\t\t\tChat:    ChatModel(this, this.options.chat),\n\t\t\tMessage: MessageModel(this, this.options.message)\n\t\t};\n\n\n\t\t//if (this.options[OPTION.CHAT_MEMORY]) {\n\t\t//\tthis._memoryChat = new Memory({\n\t\t//\t\tprovider: this.options[OPTION.CHAT_MEMORY_PROVIDER],\n\t\t//\t\tttl:      this.options[OPTION.CHAT_MEMORY_TTL]\n\t\t//\t});\n\t\t//}\n\n\t\tthis.emit('initialize');\n\t}\n\n\tinitializeComponents() {\n\t\tif (!this.components.Respond) this.register('Respond', RespondComponent);\n\t\tif (!this.components.joinQueue) this.register('joinQueue', new JoinQueueComponent(this));\n\t}\n\n\tget model() {\n\t\treturn this.__models;\n\t}\n\n\tapplyMiddleware(_Middleware) {\n\t\tif (!_Middleware.event) {\n\t\t\tdebug('middleware not specified event name');\n\t\t\treturn this;\n\t\t}\n\n\t\t_.isFunction(_Middleware)\n\t\t\t? this.use(_Middleware.event, _Middleware)\n\t\t\t: this.use(_Middleware.event, new _Middleware(this));\n\n\n\t\treturn this;\n\t}\n\n\tpre(path) {\n\t\tthis.use.apply(this, [path].concat(Array.prototype.slice.call(arguments, 1)));\n\t}\n\n\tpost(path) {\n\t\tif (!this.middleware[path]) {\n\t\t\tthis.middleware[path] = { pre: [], post: [] };\n\t\t}\n\n\t\tchain.add.apply(chain, [this.middleware[path].post].concat(Array.prototype.slice.call(arguments, 1)));\n\n\t\treturn this;\n\t}\n\n\tuse(path) {\n\t\tif (!this.middleware[path]) {\n\t\t\tthis.middleware[path] = { pre: [], post: [] };\n\t\t}\n\n\t\tchain.add.apply(chain, [this.middleware[path].pre].concat(Array.prototype.slice.call(arguments, 1)));\n\n\t\treturn this;\n\t}\n\n\tunUse(path, obj) {\n\t\tif (!(path in this.middleware)) {\n\t\t\tdebug('unUse: path not found');\n\t\t\treturn this;\n\t\t}\n\n\t\tlet index = this.middleware.pre.indexOf(obj);\n\n\t\tif (index !== -1) {\n\t\t\tthis.middleware.pre.splice(index, 1);\n\t\t} else {\n\t\t\tdebug('unuse: not found callback, already removed?')\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tunPost(path, obj) {\n\t\tif (!(path in this.middleware)) {\n\t\t\tdebug('unPost: path not found');\n\t\t\treturn this;\n\t\t}\n\n\t\tlet index = this.middleware.post.indexOf(obj);\n\n\t\tif (index !== -1) {\n\t\t\tthis.middleware.post.splice(index, 1);\n\t\t} else {\n\t\t\tdebug('unuse: not found obj, already removed?')\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tpreMiddleware(path, data) {\n\t\tvar middleware = this.middleware[path] ? this.middleware[path].pre : [];\n\n\t\treturn chain.exec(middleware, this, data)\n\t\t\t.catch(function (error) {\n\t\t\t\tdebug(error);\n\t\t\t});\n\t}\n\n\tpostMiddleware(path, data) {\n\t\tvar middleware = this.middleware[path] ? this.middleware[path].post : [];\n\n\t\treturn chain.exec(middleware, this, data)\n\t\t\t.catch(function (error) {\n\t\t\t\tdebug(error);\n\t\t\t});\n\t}\n\n\tinvoke(name, socket, data) {\n\t\tlet promise = (resolve, reject) => {\n\n\t\t\tif (!(name in this.EVENTS)) {\n\t\t\t\treturn reject();\n\t\t\t}\n\n\t\t\tchain.exec(this.EVENTS[name], this, socket, data)\n\t\t\t\t.catch(function (error) {\n\t\t\t\t\tdebug(error);\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t};\n\n\t\treturn new Promise(promise);\n\t}\n\n\taddEvent(name) {\n\t\tvar eventName = this.eventName(name);\n\n\t\tif (!this.EVENTS[eventName]) {\n\t\t\tthis.EVENTS[eventName] = [];\n\t\t}\n\n\t\tchain.add.apply(chain, [this.EVENTS[eventName]].concat(Array.prototype.slice.call(arguments, 1)));\n\n\t\treturn this;\n\t}\n\n\tremoveEvent(name) {\n\t\tvar callbacks = Array.prototype.slice.call(arguments, 1);\n\n\t\tif (!this.EVENTS[name]) {\n\t\t\tthis.EVENTS[name] = [];\n\t\t}\n\n\t\tcallbacks.forEach(function (callback) {\n\t\t\tlet indexCb;\n\n\t\t\tif ((indexCb = this.EVENTS[name].indexOf(callback)) !== -1) {\n\t\t\t\tthis.EVENTS[name].splice(indexCb, 1);\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n\n\teventName(name) {\n\t\tif (this.options[OPTION.NAMESPACE]) {\n\t\t\tlet prefix = this.options[OPTION.NAMESPACE];\n\n\t\t\treturn name.replace(/^(\\w)/, function (firstChar) {\n\t\t\t\treturn prefix + firstChar.toUpperCase();\n\t\t\t});\n\t\t}\n\n\t\treturn name;\n\t}\n\n\trevertEventName(name) {\n\t\tif (this.options[OPTION.NAMESPACE]) {\n\t\t\tlet prefix = this.options[OPTION.NAMESPACE];\n\n\t\t\treturn name.replace(prefix, '').replace(/^(\\w)/, function (firstChar) {\n\t\t\t\treturn firstChar.toLowerCase();\n\t\t\t});\n\t\t}\n\n\t\treturn name;\n\t}\n\n\tsocketAuthorized(socket, options, next) {\n\t\treturn socket && (socket.auth === true) && socket[SOCKET_USER] && next();\n\t}\n\n\tlogoutSocket(socket) {\n\t\tdelete socket.auth;\n\t\tdelete socket[SOCKET_USER];\n\t}\n\n\tgetChat(id) {\n\t\treturn new Promise((resolve, rejcet) => {\n\t\t\tif (OPTION.CHAT_MEMORY in this.options) {\n\n\t\t\t} else {\n\t\t\t\tthis.model.Chat.findById(id).then((chat) => {\n\t\t\t\t\tresolve(chat);\n\t\t\t\t}).catch(reject);\n\t\t\t}\n\t\t});\n\t}\n\n\trespond(namespace) {\n\t\treturn new this.components.Respond(this, namespace);\n\t}\n\n\tregister(componentName, NewComponent) {\n\t\tthis.components[componentName] = NewComponent;\n\t}\n\n\tregisterModel(modelName, Model) {\n\t\tthis.__models[modelName] = Model;\n\t}\n}\n\nexport default BaseClient;"]}