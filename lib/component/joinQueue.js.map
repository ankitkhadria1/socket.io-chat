{"version":3,"sources":["../../src/component/joinQueue.es6"],"names":[],"mappings":";;;;;;;;yBAAsB,aAAa;;;;;;AAInC,MAAM,kBAAkB,gCAAmB;AAC1C,YAAW,CAAC,MAAM,EAAE;AACnB,OAAK,CAAC,MAAM,CAAC,CAAC;;AAEd,MAAI,CAAC,KAAK,GAAG,IAAI,GAAG,EAAE,CAAC;EACvB;;AAED,IAAG,CAAC,MAAM,EAAE;AACX,MAAI,KAAK,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC;;AAE3B,MAAI,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE;AAC3B,OAAI,CAAC,KAAK,CAAC,GAAG,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC;GAC1B;;AAED,SAAO,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;EAC7B;;AAED,IAAG,CAAC,MAAM,EAAE,MAAM,EAAE;AACnB,MAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;;AAEnC,SAAO,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC;EAC5C;;AAED,IAAG,CAAC,MAAM,EAAE,MAAM,EAAE;AACnB,MAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;;AAEnC,MAAI,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE;AACzC,QAAK,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;GAC3B;;AAED,SAAO,IAAI,CAAC;EACZ;;AAED,OAAM,CAAC,MAAM,EAAE,MAAM,EAAE;AACtB,MAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;AACnC,MAAI,KAAK,GAAG,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;;AAE1C,MAAI,KAAK,KAAK,CAAC,CAAC,EAAE;AACjB,QAAK,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;;AAEvB,OAAI,KAAK,CAAC,MAAM,KAAK,CAAC,EAAE;AACvB,QAAI,UAAO,CAAC,MAAM,CAAC,CAAC;IACpB;GACD;;AAED,SAAO,IAAI,CAAC;EACZ;;AAED,OAAM,CAAC,MAAM,EAAE;AACd,MAAI,CAAC,KAAK,UAAO,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;;AAElC,SAAO,IAAI,CAAC;EACZ;;AAED,MAAK,GAAG;AACP,MAAI,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC;EACnB;;AAED,QAAO,CAAC,MAAM,EAAE,OAAO,EAAE;;;AACxB,MAAI,aAAa,GAAI,EAAE,CAAC;AACxB,MAAI,OAAO,GAAU,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,EAAE,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;AAC9E,MAAI,aAAa,GAAI,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;;AAEtD,eAAa,CACX,MAAM,CAAC,UAAU,YAAY,EAAE;AAC/B,UAAO,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAA;GACtC,CAAC,CACD,OAAO,CAAC,UAAU,YAAY,EAAE;AAChC,eAAY,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;GAClC,CAAC,CAAC;;AAEJ,SAAO,CAAC,OAAO,CAAC,UAAU,MAAM,EAAE;AACjC,OAAI,aAAa,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE;AAC9C,iBAAa,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;IAChC;GACD,CAAC,CAAC;;AAEH,SAAO,CACL,MAAM,CAAC,UAAU,MAAM,EAAE;AACzB,UAAO,aAAa,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC;GAC5C,CAAC,CACD,OAAO,CAAC,UAAC,aAAa,EAAK;AAC3B,SAAK,GAAG,CAAC,aAAa,EAAE,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC;GACxC,CAAC,CAAC;EACJ;CACD;;qBAEc,kBAAkB","file":"joinQueue.js","sourcesContent":["import Component from './component';\n\n// TODO: clear old records by setTimeout\n\nclass JoinQueueComponent extends Component {\n\tconstructor(client) {\n\t\tsuper(client);\n\n\t\tthis.queue = new Map();\n\t}\n\n\tget(userId) {\n\t\tlet strId = String(userId);\n\n\t\tif (!this.queue.has(strId)) {\n\t\t\tthis.queue.set(strId, []);\n\t\t}\n\n\t\treturn this.queue.get(strId);\n\t}\n\n\thas(userId, chatId) {\n\t\tlet queue = this.queue.get(userId);\n\n\t\treturn queue.indexOf(String(chatId)) !== -1;\n\t}\n\n\tadd(userId, chatId) {\n\t\tlet queue = this.queue.get(userId);\n\n\t\tif (queue.indexOf(String(chatId)) === -1) {\n\t\t\tqueue.push(String(chatId));\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tremove(userId, chatId) {\n\t\tlet queue = this.queue.get(userId);\n\t\tlet index = queue.indexOf(String(chatId));\n\n\t\tif (index !== -1) {\n\t\t\tqueue.splice(index, 1);\n\n\t\t\tif (queue.length === 0) {\n\t\t\t\tthis.delete(userId);\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tdelete(userId) {\n\t\tthis.queue.delete(String(userId));\n\n\t\treturn this;\n\t}\n\n\tclear() {\n\t\tthis.queue.clear();\n\t}\n\n\tresolve(chatId, members) {\n\t\tlet uniqueClients  = [];\n\t\tlet clients        = this.client.namespace.to(String(chatId)).clients('room');\n\t\tlet onlineClients  = this.client.members.get(members);\n\n\t\tonlineClients\n\t\t\t.filter(function (onlineClient) {\n\t\t\t\treturn clients.indexOf(clients) === -1\n\t\t\t})\n\t\t\t.forEach(function (onlineClient) {\n\t\t\t\tonlineClient.join(String(chatId));\n\t\t\t});\n\n\t\tclients.forEach(function (client) {\n\t\t\tif (uniqueClients.indexOf(client.user) === -1) {\n\t\t\t\tuniqueClients.push(client.user);\n\t\t\t}\n\t\t});\n\n\t\tmembers\n\t\t\t.filter(function (member) {\n\t\t\t\treturn uniqueClients.indexOf(member) === -1;\n\t\t\t})\n\t\t\t.forEach((offlineMember) => {\n\t\t\t\tthis.add(offlineMember, String(chatId));\n\t\t\t});\n\t}\n}\n\nexport default JoinQueueComponent;"]}