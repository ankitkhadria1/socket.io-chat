{"version":3,"sources":["../src/client.es6"],"names":[],"mappings":";;;;;;;;;;qBAA6B,SAAS;;0BACT,cAAc;;;;2BACd,eAAe;;IAAhC,WAAW;;sBACM,UAAU;;IAA3B,KAAK;;uBACY,WAAW;;IAA5B,MAAM;;AAElB,MAAM,MAAM,iCAAoB;AAC/B,YAAW,CAAC,MAAM,EAAE,OAAO,EAAE;AAC5B,OAAK,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;;AAEvB,MAAI,CAAC,cAAc,CAAC,QAAQ,GAAG,GAAG,CAAC;AACnC,MAAI,CAAC,gBAAgB,CAAC,QAAQ,GAAG,CAAC,CAAC;;AAEnC,MAAI,CACF,QAAQ,CAAC,KAAK,CAAC,YAAY,EAAE,IAAI,CAAC,cAAc,CAAC,CACjD,QAAQ,CAAC,KAAK,CAAC,QAAQ,EAAE,IAAI,CAAC,gBAAgB,EAAE,IAAI,CAAC,SAAS,CAAC,CAC/D,QAAQ,CAAC,KAAK,CAAC,WAAW,EAAE,IAAI,CAAC,gBAAgB,EAAE,IAAI,CAAC,UAAU,CAAC,CAKpE;;;;;;AAED,MAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,0BAA0B,CAAC,EAAE;AACrD,OAAI,CAAC,eAAe,CAAC,WAAW,CAAC,uBAAuB,CAAC,CAAC;GAC1D;;AAED,MAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,yBAAyB,CAAC,EAAE;AACpD,OAAI,CAAC,eAAe,CAAC,WAAW,CAAC,sBAAsB,CAAC,CAAC;GACzD;;AAED,MAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,mBAAmB,CAAC,EAAE;AAC9C,OAAI,CAAC,eAAe,CAAC,WAAW,CAAC,iBAAiB,CAAC,CAAC;GACpD;;AAED,MAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,iBAAiB,CAAC,EAAE;AAC5C,OAAI,CAAC,eAAe,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC;GACjD;;AAED,MAAI,CAAC,OAAO,CAAC,eAAe,EAAE;AAC7B,OAAI,CAAC,UAAU,EAAE,CAAC;;AAElB,OAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CACxC,IAAI,CAAC,YAAY;;IAEjB,CAAC,SACI,CAAC,UAAU,GAAG,EAAE;AACrB,WAAO,CAAC,GAAG,CAAC,OAAO,EAAE,GAAG,CAAC,KAAK,CAAC,CAAC;IAChC,CAAC,CAAA;GACH;EACD;;AAED,eAAc,CAAC,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE;AAClC,QAAM,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,YAAY,CAAC,EAAE,EAAE,MAAM,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE,EAAE,CAAC,CAAA;EAChF;;AAED,UAAS,CAAC,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE;AAChC,MAAI,CAAC,OAAO,CAAC,OAAO,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC;EACnC;;AAED,QAAO,GAA4B;;;MAA3B,OAAO,yDAAG,EAAE;MAAE,IAAI,yDAAG,IAAI;;;;AAGhC,SAAO,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,QAAQ,EAAE,OAAO,CAAC,CAChD,IAAI,CAAC,UAAC,WAAW,EAAK;AACtB,OAAI,IAAI,GAAG,IAAI,MAAK,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;;AAE7C,OAAI,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;;AAEtB,UAAO,IAAI,CAAC,IAAI,EAAE,CAAC;GACnB,CAAC,CACD,IAAI,CAAC,YAAY;AACjB,UAAO,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAA;GACnD,CAAC,SACI,CAAC,UAAU,KAAK,EAAE;AACvB,qBAAM,KAAK,CAAC,KAAK,CAAC,CAAC;GACnB,CAAC,CACF;EACD;;AAED,WAAU,GAAe;;;MAAd,OAAO,yDAAG,EAAE;;AACtB,SAAO,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,QAAQ,EAAE,OAAO,CAAC,CAChD,IAAI,CAAC,UAAC,IAAI,EAAK;AACf,UAAK,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;GAChC,CAAC,SACI,CAAC,UAAU,KAAK,EAAE;AACvB,qBAAM,KAAK,CAAC,KAAK,CAAC,CAAC;GACnB,CAAC,CACF;EACD;;AAED,mBAAkB,GAAG,EACpB;;AAED,UAAS,CAAC,MAAM,EAAE,EAEjB;CACD;;qBAEc,MAAM","file":"client.js","sourcesContent":["import { debug }        from './debug';\nimport BaseClient       from \"./baseClient\";\nimport * as middleWares from './middlewares';\nimport * as EVENT       from './events';\nimport * as OPTION      from './options';\n\nclass Client extends BaseClient {\n\tconstructor(server, options) {\n\t\tsuper(server, options);\n\n\t\tthis.onAuthenticate.priority = 100;\n\t\tthis.socketAuthorized.priority = 0;\n\n\t\tthis\n\t\t\t.addEvent(EVENT.AUTHENTICATE, this.onAuthenticate)\n\t\t\t.addEvent(EVENT.NEW_CHAT, this.socketAuthorized, this.onNewChat)\n\t\t\t.addEvent(EVENT.NEW_MESSAGE, this.socketAuthorized, this.newMessage)\n\t\t\t//.addEvent(EVENT.START_WRITE, this.socketAuthorized, this.onStartWrite)\n\t\t\t//.addEvent(EVENT.END_WRITE, this.socketAuthorized, this.onEndWrite)\n\t\t\t//.addEvent(EVENT.FOCUS, this.socketAuthorized, this.onFocus)\n\t\t\t//.addEvent(EVENT.BLUR, this.socketAuthorized, this.onBlur)\n\t\t;\n\n\t\tif (this._options[OPTION.CHAT_RECORD_COUNT_MESSAGES]) {\n\t\t\tthis.applyMiddleware(middleWares.chatRecordCountMessages);\n\t\t}\n\n\t\tif (this._options[OPTION.CHAT_RECORD_LAST_MESSAGES]) {\n\t\t\tthis.applyMiddleware(middleWares.chatRecordLastMessages);\n\t\t}\n\n\t\tif (this._options[OPTION.CHAT_SINGLE_PRIVATE]) {\n\t\t\tthis.applyMiddleware(middleWares.chatSinglePrivate);\n\t\t}\n\n\t\tif (this._options[OPTION.CHAT_NEW_ON_GROUP]) {\n\t\t\tthis.applyMiddleware(middleWares.chatNewOnGroup);\n\t\t}\n\n\t\tif (!options.delayInitialize) {\n\t\t\tthis.initialize();\n\n\t\t\tthis.model.Chat.find({ name: 1 }).exec({})\n\t\t\t\t.then(function () {\n\t\t\t\t\t//console.log('then', arguments);\n\t\t\t\t})\n\t\t\t\t.catch(function (err) {\n\t\t\t\t\tconsole.log('catch', err.stack);\n\t\t\t\t})\n\t\t}\n\t}\n\n\tonAuthenticate(socket, data, next) {\n\t\tsocket.emit(this.eventName(EVENT.AUTHENTICATE), { result: { user: data.user } })\n\t}\n\n\tonNewChat(socket, options, next) {\n\t\tthis.newChat(options, socket.user);\n\t}\n\n\tnewChat(options = {}, user = null) {\n\t\t// TODO: first message\n\n\t\treturn this.preMiddleware(EVENT.NEW_CHAT, options)\n\t\t\t.then((postOptions) => {\n\t\t\t\tlet chat = new this.model.Chat(options.data);\n\n\t\t\t\tchat.setCreator(user);\n\n\t\t\t\treturn chat.save();\n\t\t\t})\n\t\t\t.then(function () {\n\t\t\t\treturn this.postMiddleware(EVENT.NEW_CHAT, options)\n\t\t\t})\n\t\t\t.catch(function (error) {\n\t\t\t\tdebug(error.stack);\n\t\t\t})\n\t\t;\n\t}\n\n\tnewMessage(options = {}) {\n\t\treturn this.preMiddleware(EVENT.NEW_CHAT, options)\n\t\t\t.then((post) => {\n\t\t\t\tthis.post(EVENT.NEW_CHAT, post);\n\t\t\t})\n\t\t\t.catch(function (error) {\n\t\t\t\tdebug(error.stack);\n\t\t\t})\n\t\t;\n\t}\n\n\tsystemNotification() {\n\t}\n\n\tauthorize(socket) {\n\n\t}\n}\n\nexport default Client;"]}