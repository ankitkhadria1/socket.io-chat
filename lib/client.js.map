{"version":3,"sources":["../src/client.es6"],"names":[],"mappings":"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","file":"src/client.es6","sourcesContent":["(function () {\n\t\"use strict\";\n\n\tvar IO           = require('socket.io'),\n\t\tdb           = require('./db'),\n\t\tChat         = require('./chat'),\n\t\tMessage      = require('./message'),\n\t\tEventEmitter = require('events').EventEmitter,\n\t\tutil         = require('util'),\n\t\t_            = require('underscore'),\n\t\tFLAGS        = require('./flags'),\n\t\tsocketMixin  = require('./socket'),\n\t\tRooms        = require('./rooms'),\n\t\tMembers      = require('./members'),\n\t\tClientSocket = require('./clientSocket'),\n\t\tClientAction = require('./clientAction'),\n\t\tClientError  = require('./error');\n\n\trequire('source-map-support').install();\n\n\t/**\n\t * @class ChatClient\n\t */\n\tclass ChatClient extends EventEmitter {\n\t\t/**\n\t\t * @param server Http node.js server\n\t\t * @param {object} options\n\t\t * @param {String} options.collectionChat\n\t\t * @param {String} options.collectionMessages\n\t\t * @param {object} options.EVENTS\n\t\t * @param {String} options.eventPrefix\n\t\t */\n\t\tconstructor(server, options = {}) {\n\t\t\tsuper();\n\n\t\t\tif (!server) {\n\t\t\t\tthrow new Error('first argument required `http` server');\n\t\t\t}\n\n\t\t\tvar io, self = this;\n\t\t\tvar collectionChat, collectionChatMessages, EVENTS, eventPrefix;\n\n\t\t\tcollectionChat         = options.collectionChat || 'chats';\n\t\t\tcollectionChatMessages = options.collectionMessage || 'chats_messages';\n\n\t\t\teventPrefix = options.eventPrefix || '';\n\n\t\t\tEVENTS = {\n\t\t\t\tAUTHENTICATE:     'authenticate',\n\t\t\t\tCREATE:           'create',\n\t\t\t\tLEAVE:            'leave',\n\t\t\t\tADDMEMBER:        'addMember',\n\t\t\t\tREMOVEMEMBER:     'removeMember',\n\t\t\t\tNEWMESSAGE:       'newMessage',\n\t\t\t\tNEWSYSTEMMESSAGE: 'newSystemMessage',\n\t\t\t\tCHANGETITLE:      'changeTitle',\n\t\t\t\tFINDMESSAGESLAST: 'findMessagesLast',\n\t\t\t\tFINDMESSAGESFROM: 'findMessagesFrom',\n\t\t\t\tFINDMESSAGESAT:   'findMessagesAt',\n\t\t\t\tFINDCHATS:        'findChats',\n\t\t\t\tFINDCHAT:         'findChat'\n\t\t\t};\n\n\t\t\t_.assign(EVENTS, _.pick(options.EVENTS || {}, Object.keys(EVENTS)));\n\n\t\t\tEVENTS = _.mapObject(EVENTS, function (value) {\n\t\t\t\treturn eventPrefix + value;\n\t\t\t});\n\n\t\t\tthis.EVENTS = EVENTS;\n\n\t\t\tthis.__validations = {};\n\t\t\tthis.__models      = {};\n\n\t\t\tthis.action = new ClientAction();\n\t\t\tthis.socket = new ClientSocket();\n\n\t\t\tthis.__members = new Members();\n\t\t\tthis.__rooms   = new Rooms();\n\n\t\t\tthis.__models.chat    = Chat({ collection: collectionChat });\n\t\t\tthis.__models.message = Message({ collection: collectionChatMessages });\n\n\t\t\tthis.io = io = IO(server, { maxHttpBufferSize: 1000 });\n\n\t\t\tio.on('connection', function (socket) {\n\t\t\t\tself.emit('connection', socket);\n\n\t\t\t\tsocket.on(EVENTS.AUTHENTICATE, function (data) {\n\t\t\t\t\tself.socket.onAuthenticate(self, this, data);\n\t\t\t\t});\n\n\t\t\t\tsocket.on(EVENTS.CREATE, function (data) {\n\t\t\t\t\tself.authorize(this) && self.socket.onCreate(self, this, data);\n\t\t\t\t});\n\n\t\t\t\tsocket.on(EVENTS.LEAVE, function (data) {\n\t\t\t\t\tself.authorize(this) && self.socket.onLeave(self, this, data);\n\t\t\t\t});\n\n\t\t\t\tsocket.on(EVENTS.ADDMEMBER, function (data) {\n\t\t\t\t\tself.authorize(this) && self.socket.onAddMember(self, this, data);\n\t\t\t\t});\n\n\t\t\t\tsocket.on(EVENTS.REMOVEMEMBER, function (data) {\n\t\t\t\t\tself.authorize(this) && self.socket.onRemoveMember(self, this, data);\n\t\t\t\t});\n\n\t\t\t\tsocket.on(EVENTS.NEWMESSAGE, function (data) {\n\t\t\t\t\tself.authorize(this) && self.socket.onNewMessage(self, this, data);\n\t\t\t\t});\n\n\t\t\t\tsocket.on(EVENTS.CHANGETITLE, function (data) {\n\t\t\t\t\tself.authorize(this) && self.socket.onChangeTitle(self, this, data);\n\t\t\t\t});\n\n\t\t\t\tsocket.on(EVENTS.FINDMESSAGESLAST, function (data) {\n\t\t\t\t\tself.authorize(this) && self.socket.onFindMessagesLast(self, this, data);\n\t\t\t\t});\n\n\t\t\t\tsocket.on(EVENTS.FINDMESSAGESFROM, function (data) {\n\t\t\t\t\tself.authorize(this) && self.socket.onFindMessagesFrom(self, this, data);\n\t\t\t\t});\n\n\t\t\t\tsocket.on(EVENTS.FINDMESSAGESAT, function (data) {\n\t\t\t\t\tself.authorize(this) && self.socket.onFindMessagesAt(self, this, data);\n\t\t\t\t});\n\n\t\t\t\tsocket.on(EVENTS.FINDCHATS, function (data) {\n\t\t\t\t\tself.authorize(this) && self.socket.onFindChats(self, this, data);\n\t\t\t\t});\n\n\t\t\t\tsocket.on(EVENTS.FINDCHAT, function (data) {\n\t\t\t\t\tself.authorize(this) && self.socket.onFindChat(self, this, data);\n\t\t\t\t});\n\n\t\t\t\tsocket.on('error', function (error) {\n\t\t\t\t\tconsole.log(error);\n\t\t\t\t\tself.emit('error', this, error.event, error);\n\t\t\t\t});\n\n\t\t\t\tsocket.on('disconnect', function () {\n\t\t\t\t\tsocket.auth = false;\n\n\t\t\t\t\tself.__members.remove(socket.user, socket);\n\t\t\t\t\tself.emit('disconnect', socket);\n\t\t\t\t});\n\n\t\t\t\t_.extend(socket, socketMixin);\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Return client event names\n\t\t *\n\t\t * @returns {EVENTS}\n\t\t */\n\t\tget eventNames() {\n\t\t\treturn this.EVENTS;\n\t\t}\n\n\t\t/**\n\t\t * Set client event names\n\t\t *\n\t\t * @param {object} events\n\t\t * @returns {void}\n\t\t */\n\t\tset eventNames(events) {\n\t\t\t_.defaults(this.EVENTS, events);\n\t\t}\n\n\t\t/**\n\t\t * Return module flags\n\t\t *\n\t\t * @returns {*}\n\t\t */\n\t\tget FLAGS() {\n\t\t\treturn FLAGS;\n\t\t}\n\n\t\t/**\n\t\t * Checks the authorization of the socket\n\t\t *\n\t\t * @param {Socket} socket\n\t\t * @returns {boolean}\n\t\t */\n\t\tauthorize(socket) {\n\t\t\treturn !!socket.auth;\n\t\t}\n\n\t\t/**\n\t\t * Return model by name (chat/message)\n\t\t *\n\t\t * var ChatModel = client.model('chat');\n\t\t * new ChatModel()\n\t\t *\n\t\t * @param {String} name\n\t\t * @returns {*}\n\t\t */\n\t\tmodel(name) {\n\t\t\treturn this.__models[name];\n\t\t}\n\n\t\t/**\n\t\t * Middleware for socket.io\n\t\t *\n\t\t * @param {function} cb\n\t\t * @returns {ChatClient}\n\t\t */\n\t\tuse(cb) {\n\t\t\tthis.io.use(cb);\n\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * Validate client event\n\t\t *\n\t\t * client.validate('addMember', function (socket, data, next) {\n\t\t *     if (data.flag !== client.FLAGS.MEMBER) {\n\t\t *       next(new Error('Not allowed'));\n\t\t *     }\n\t\t * })\n\t\t *\n\t\t *\n\t\t * @param {String} path\n\t\t * @param {function} cb\n\t\t * @returns {ChatClient}\n\t\t */\n\t\tvalidate(path, cb) {\n\t\t\tpath = path || 'default';\n\t\t\tcb   = cb || function () {\n\t\t\t\t};\n\n\t\t\tif (!this.__validations[path]) {\n\t\t\t\tthis.__validations[path] = [];\n\t\t\t}\n\n\t\t\tthis.__validations[path].push(cb);\n\n\t\t\treturn this;\n\t\t}\n\n\t\t/**\n\t\t * Create new chat\n\t\t *\n\t\t * @param {object} data\n\t\t * @param {String} data.name\n\t\t * @param {String} data.title\n\t\t * @param {ObjectId} creator\n\t\t * @returns {Promise}\n\t\t */\n\t\tcreate(data, creator) {\n\t\t\tvar chat = new (this.model('chat'))(data);\n\n\t\t\tchat.setCreator(creator);\n\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tthis._validatePath(this.EVENTS.CREATE, { chat, creator, data })\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tchat.save((error, result) => {\n\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\treturn reject(error);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tresolve(chat);\n\t\t\t\t\t\t\tthis.emit(this.EVENTS.CREATE, chat);\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.catch(reject);\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Add member to chat\n\t\t *\n\t\t * @param {ChatModel} chat\n\t\t * @param {ObjectId} member\n\t\t * @param {ObjectId} performer\n\t\t * @param {Number} flag\n\t\t * @returns {Promise}\n\t\t */\n\t\taddMember(chat, member, performer = null, flag = FLAGS.MEMBER) {\n\t\t\tchat.addMember(member);\n\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tthis._validatePath(this.EVENTS.ADDMEMBER, { chat, member, performer, flag })\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\treturn this.action.validate(flag, { chat, performer });\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tchat.update((error) => {\n\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\treturn reject(error);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tresolve(member);\n\n\t\t\t\t\t\t\tthis.emit(this.EVENTS.ADDMEMBER, chat, member);\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.catch(function (error) {\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Remove member from chat\n\t\t *\n\t\t * @param {ChatModel} chat\n\t\t * @param {ObjectId} member\n\t\t * @param {ObjectId} performer\n\t\t * @param {Number} flag\n\t\t * @returns {Promise}\n\t\t */\n\t\tremoveMember(chat, member, performer = null, flag = FLAGS.AUTHOR) {\n\t\t\tchat.removeMember(member);\n\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tthis._validatePath(this.EVENTS.REMOVEMEMBER, { chat, member, performer, flag })\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\treturn this.action.validate(flag, { chat, performer });\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tchat.update((error) => {\n\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\treturn reject(error);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tresolve(member);\n\n\t\t\t\t\t\t\tthis.emit(this.EVENTS.REMOVEMEMBER, chat, member);\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.catch(reject);\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Create new message in chat\n\t\t *\n\t\t * @param {ChatModel} chat\n\t\t * @param {object} messageData\n\t\t * @param {String} messageData.text\n\t\t * @param {ObjectId} performer\n\t\t * @param {Number} flag\n\t\t * @returns {Promise}\n\t\t */\n\t\tnewMessage(chat, messageData, performer = null, flag = FLAGS.MEMBER) {\n\t\t\tvar message = null;\n\n\t\t\tmessage = new (this.model('message'))(messageData);\n\t\t\tmessage.setChat(chat);\n\t\t\tmessage.setAuthor(performer);\n\t\t\tmessage.setReceivers(chat.members);\n\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tthis._validatePath(this.EVENTS.NEWMESSAGE, { chat, message, performer, flag })\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\treturn this.action.validate(flag, { chat, performer });\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tmessage.save((error) => {\n\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\treturn reject(error);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tresolve(message);\n\n\t\t\t\t\t\t\tthis.emit(this.EVENTS.NEWMESSAGE, chat, message);\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.catch(reject);\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Change title in chat\n\t\t *\n\t\t * @param {ChatModel} chat\n\t\t * @param {String} title\n\t\t * @param {ObjectId} performer\n\t\t * @param {Number} flag\n\t\t * @returns {Promise}\n\t\t */\n\t\tchangeTitle(chat, title, performer = null, flag = FLAGS.MEMBER) {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tthis._validatePath(this.EVENTS.CHANGETITLE, { chat, title, performer, flag })\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\treturn this.action.validate(flag, { chat, performer });\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tchat.setTitle(title)\n\t\t\t\t\t\t\t.update((error) => {\n\t\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\t\treturn reject(error);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tresolve(chat);\n\n\t\t\t\t\t\t\t\tthis.emit(this.EVENTS.CHANGETITLE, chat, title);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.catch(reject);\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Leave performer from chat\n\t\t *\n\t\t * @param {ChatModel} chat\n\t\t * @param {ObjectId} performer\n\t\t * @param flag\n\t\t * @returns {Promise}\n\t\t */\n\t\tleave(chat, performer, flag = FLAGS.MEMBER) {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tthis._validatePath(this.EVENTS.LEAVE, { chat, performer, flag })\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\treturn this.action.validate(flag, { chat, performer });\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tchat.removeMember(performer);\n\t\t\t\t\t\tchat.update((error) => {\n\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\treturn reject(error);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tresolve(performer);\n\n\t\t\t\t\t\t\tthis.emit(this.EVENTS.LEAVE, chat, performer);\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t\t.catch(reject);\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Create new system message (member add/remove chat, changeTitle, or event)\n\t\t *\n\t\t * @param {ChatModel} chat\n\t\t * @param {object} data\n\t\t * @returns {Promise}\n\t\t */\n\t\tnewSystemMessage(chat, data) {\n\t\t\tvar message = null;\n\n\t\t\tmessage = new (this.model('message'))({ text: ' ' });\n\t\t\tmessage.setChat(chat);\n\t\t\tmessage.setSystemAuthor();\n\t\t\tmessage.setReceivers(chat.members);\n\t\t\tmessage.setSystem(data);\n\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tthis._validatePath(this.EVENTS.NEWSYSTEMMESSAGE, { chat, message, data })\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tmessage.save((error) => {\n\t\t\t\t\t\t\tif (error) {\n\t\t\t\t\t\t\t\treturn reject(error);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tresolve(message);\n\n\t\t\t\t\t\t\tthis.emit(this.EVENTS.NEWSYSTEMMESSAGE, chat, message);\n\t\t\t\t\t\t});\n\t\t\t\t\t})\n\t\t\t\t\t.catch(reject);\n\t\t\t});\n\t\t}\n\n\t\t/** find messages */\n\n\t\t/**\n\t\t * Find last message in chat\n\t\t *\n\t\t * @param {ObjectId} chatId\n\t\t * @param {ObjectId} user\n\t\t * @param {Number} count\n\t\t * @param {Number} flag\n\t\t * @returns {Promise}\n\t\t */\n\t\tfindLastMessages(chatId, user, count, flag = FLAGS.RECEIVER) {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tthis._validatePath(this.EVENTS.FINDMESSAGESLAST, { chatId, user, count, flag })\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\treturn this.model('message').findLast(chatId, user, count);\n\t\t\t\t\t})\n\t\t\t\t\t.then(resolve)\n\t\t\t\t\t.catch(reject);\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Find messages in chat, start from messageId\n\t\t *\n\t\t * @param {ObjectId} chatId\n\t\t * @param {ObjectId} messageId\n\t\t * @param {ObjectId} user\n\t\t * @param {Number} count\n\t\t * @param {Number} flag\n\t\t * @returns {Promise}\n\t\t */\n\t\tfindFromMessages(chatId, messageId, user, count, flag = FLAGS.RECEIVER) {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tthis._validatePath(this.EVENTS.FINDMESSAGESFROM, { chatId, messageId, user, count, flag })\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\treturn this.model('message').findFrom(chatId, messageId, user, count)\n\t\t\t\t\t})\n\t\t\t\t\t.then(resolve, reject)\n\t\t\t\t\t.catch(reject);\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Find messages in chat, to the message id\n\t\t *\n\t\t * @param {ObjectId} chatId\n\t\t * @param {ObjectId} messageId\n\t\t * @param {ObjectId} user\n\t\t * @param {Number} count\n\t\t * @param {Number} flag\n\t\t * @returns {Promise}\n\t\t */\n\t\tfindAtMessages(chatId, messageId, user, count, flag = FLAGS.RECEIVER) {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tthis._validatePath(this.EVENTS.FINDMESSAGESAT, { chatId, messageId, user, count, flag })\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\treturn this.model('message').findAt(chatId, messageId, user, count)\n\t\t\t\t\t})\n\t\t\t\t\t.then(resolve, reject)\n\t\t\t\t\t.catch(reject);\n\t\t\t});\n\t\t}\n\n\t\t/** find chats */\n\n\t\tfindChats(user, count = 10) {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tthis._validatePath(this.EVENTS.FINDCHATS, { user, count })\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\treturn this.model('chat').findAllByMember(user)\n\t\t\t\t\t})\n\t\t\t\t\t.then(resolve, reject)\n\t\t\t\t\t.catch(reject);\n\t\t\t});\n\t\t}\n\n\t\tfindChatById(user, chatId) {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tthis._validatePath(this.EVENTS.FINDCHAT, { user, chatId })\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\treturn this.model('chat').findByMember(chatId, user)\n\t\t\t\t\t})\n\t\t\t\t\t.then(resolve, reject)\n\t\t\t\t\t.catch(reject);\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Used in public methods before/save update models (middleware)\n\t\t *\n\t\t * @param {String} path\n\t\t * @param {Socket} socket\n\t\t * @param {object} data\n\t\t * @returns {Promise}\n\t\t * @private\n\t\t */\n\t\t_validatePath(path, data) {\n\t\t\tvar validations = this.__validations[path],\n\t\t\t\tindex       = 0;\n\n\t\t\tif (!validations) {\n\t\t\t\tvalidations = [];\n\t\t\t}\n\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tfunction next(error) {\n\t\t\t\t\tif (typeof error !== \"undefined\") {\n\t\t\t\t\t\treturn reject(error);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar validation = validations[index];\n\n\t\t\t\t\tif (validation) {\n\t\t\t\t\t\tindex++;\n\t\t\t\t\t\treturn validation(data, next);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (index === validations.length) {\n\t\t\t\t\t\treturn resolve();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tnext();\n\t\t\t});\n\t\t}\n\n\t\t/**\n\t\t * Close socket.io, remove all event listeners\n\t\t *\n\t\t */\n\t\tdestroy() {\n\t\t\tthis.io.close();\n\t\t\tthis.removeAllListeners();\n\t\t}\n\t}\n\n\tmodule.exports = ChatClient;\n}());"]}