{"version":3,"sources":["../src/middlewares.es6"],"names":[],"mappings":"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","file":"middlewares.js","sourcesContent":["import deepExtend  from 'deep-extend';\nimport * as EVENT  from './events';\nimport * as OPTION from './options';\n\nclass Middleware {\n\tconstructor() {\n\n\t}\n}\n\nexport default Middleware;\n\nexport class chatRecordLastMessages extends Middleware {\n\tstatic event (){\n\t\treturn EVENT.NEW_MESSAGE;\n\t}\n\n\tconstructor(client) {\n\t\tsuper();\n\n\t\tthis.client = client;\n\t\tthis.count = this.client._options[OPTION.CHAT_RECORD_LAST_MESSAGES_COUNT] || 10;\n\n\t\tdeepExtend(client._options, {\n\t\t\tchat: {\n\t\t\t\tschema: {\n\t\t\t\t\tproperties: {\n\t\t\t\t\t\tcountMessages: {\n\t\t\t\t\t\t\t\"type\":    \"number\",\n\t\t\t\t\t\t\t'default': \"Number\"\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\n\texec(options, next) {\n\t\tif (!options.chat.lastMessages) {\n\t\t\toptions.chat.set('lastMessages', []);\n\t\t}\n\n\t\tif (options.chat.lastMessages.length > this.count) {\n\t\t\toptions.chat.$pull('lastMessages.0')\n\t\t}\n\n\t\toptions.chat.$push('lastMessages', options.message.toJSON());\n\n\t\tnext();\n\t}\n}\n\nexport class chatRecordCountMessages extends Middleware {\n\tstatic event (){\n\t\treturn EVENT.NEW_MESSAGE;\n\t}\n\n\tconstructor(client) {\n\t\tsuper();\n\t}\n\n\texec(options, next) {\n\t\tif (typeof options.chat.countMessages === 'undefined' || options.chat.countMessages === null) {\n\t\t\toptions.chat.set('countMessages', 0);\n\t\t}\n\n\t\toptions.chat.countMessages++;\n\n\t\tnext();\n\t}\n}\n\nexport class chatSinglePrivate extends Middleware {\n\tstatic event (){\n\t\treturn EVENT.NEW_CHAT;\n\t}\n\n\tconstructor(client) {\n\t\tsuper();\n\t\tthis.client = client;\n\t}\n\n\texec(options, next) {\n\t\tif (options.chat.type === 'private') {\n\t\t\tthis.client.model.Chat.findEqual(options.chat)\n\t\t\t\t.then(function (equalChat) {\n\t\t\t\t\tequalChat && (options.chat = equalChat);\n\t\t\t\t\tequalChat && (options.chat.isEqual = true);\n\t\t\t\t\tnext();\n\t\t\t\t})\n\t\t\t\t.catch(next);\n\t\t} else {\n\t\t\tnext();\n\t\t}\n\t}\n}\n\nexport class chatNewOnGroup extends Middleware {\n\tstatic event (){\n\t\treturn EVENT.ADD_MEMBER;\n\t}\n\n\tconstructor(client) {\n\t\tsuper();\n\t\tthis.client = client;\n\t}\n\n\texec(options, next) {\n\t\tvar chat;\n\n\t\tif (options.chat.type === 'group' && options.chat.members.length === 2) {\n\t\t\tchat = new this.client.model.Chat();\n\t\t\tchat.set(options.chat.toJSON());\n\n\t\t\toptions.chat = chat;\n\t\t}\n\n\t\tnext();\n\t}\n}"]}