{"version":3,"sources":["../src/baseClient.es6"],"names":[],"mappings":";;;;;;;;;;wBAA6B,WAAW;;;;sBACX,QAAQ;;;;0BACR,YAAY;;;;0BACZ,aAAa;;;;qBACb,SAAS;;0BACT,eAAe;;;;6BACf,kBAAkB;;;;uBAClB,WAAW;;;;qBACX,SAAS;;;;sBACT,UAAU;;;;uBACV,YAAY;;;;qBACX,SAAS;;IAA3B,KAAK;;2BACY,eAAe;;IAAhC,WAAW;;uBACM,WAAW;;IAA5B,MAAM;;uBACW,UAAU;;IAA3B,KAAK;;AAEjB,OAAO,CAAC,oBAAoB,CAAC,CAAC,OAAO,EAAE,CAAC;;AAExC,IAAI,MAAM,GAAG,SAAT,MAAM,CAAa,MAAM,EAAE;AAC9B,QAAO,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,mBAAmB,EAAE,IAAI,CAAC,CAAC;CACjF,CAAC;;AAEF,IAAM,aAAa,GAAG,YAAY,CAAC;AACnC,IAAM,WAAW,GAAK,MAAM,CAAC;;AAE7B,MAAM,UAAU,6BAAsB;AACrC,YAAW,CAAC,MAAM,EAAgB;MAAd,OAAO,yDAAG,EAAE;;AAC/B,OAAK,EAAE,CAAC;;AAER,MAAI,CAAC,MAAM,EAAE;AACZ,SAAM,IAAI,KAAK,CAAC,uCAAuC,CAAC,CAAC;GACzD;;AAED,MAAI,CAAC,OAAO,CAAC,EAAE,EAAE;AAChB,SAAM,IAAI,KAAK,CAAC,+BAA+B,CAAC,CAAC;GACjD;;AAED,MAAI,CAAC,OAAO,CAAC,EAAE,CAAC,OAAO,EAAE;AACxB,SAAM,IAAI,KAAK,CAAC,+BAA+B,CAAC,CAAC;GACjD;;AAED,MAAI,CAAC,OAAO,CAAC,EAAE,CAAC,QAAQ,EAAE;AACzB,SAAM,IAAI,KAAK,CAAC,0CAA0C,CAAC,CAAC;GAC5D;;AAED,MAAI,CAAC,YAAY,GAAG,EAAE,CAAC;AACvB,MAAI,CAAC,QAAQ,GAAO,wBAAE,KAAK,CAAC,OAAO,CAAC,CAAC;AACrC,MAAI,CAAC,GAAG,GAAY,2BAAG,MAAM,EAAE,6BAAW,EAAE,iBAAiB,EAAE,IAAI,EAAE,EAAE,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,EAAE,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;AACxG,MAAI,CAAC,MAAM,GAAS,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;AACxC,MAAI,CAAC,KAAK,GAAU,wBAAW,CAAC;AAChC,MAAI,CAAC,OAAO,GAAQ,0BAAa,CAAC;EAClC;;AAED,WAAU,GAAG;;;AACZ,MAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;;AAE5B,MAAI,CAAC,GAAG,GAAG,yBAAO,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC;AACpC,MAAI,CAAC,GAAG,CAAC,EAAE,CAAC,aAAa,EAAE,UAAC,MAAM,EAAK;AACtC,OAAI,OAAO,QAAO,CAAC;;AAEnB,OAAI,iBAAiB,GAAG,SAApB,iBAAiB,CAAa,KAAK,EAAE,MAAM,EAAE,IAAI,EAAE;AACtD,WAAO,CAAC,MAAM,CAAC,KAAK,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC;IACpC,CAAC;;AAEF,QAAK,IAAI,KAAI,IAAI,MAAK,MAAM,EAAE;AAC7B,QAAI,SAAS,GAAG,KAAI,CAAC;;AAErB,UAAM,CAAC,EAAE,CAAC,SAAS,EAAG,CAAA,UAAU,KAAK,EAAE;AACtC,YAAO,YAAqB;UAAX,IAAI,yDAAG,EAAE;;AACzB,uBAAiB,CAAC,KAAK,EAAE,MAAM,EAAE,IAAI,CAAC,CAAA;MACtC,CAAC;KACF,CAAA,CAAC,SAAS,CAAC,CAAE,CAAC;IACf;;AAED,SAAM,CAAC,EAAE,CAAC,OAAO,EAAE,UAAU,KAAK,EAAE;AACnC,WAAO,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;IACzB,CAAC,CAAC;;AAEH,SAAM,CAAC,EAAE,CAAC,KAAK,CAAC,OAAO,EAAE,YAAM;AAC9B,QAAI,MAAM,GAAG,EAAE,CAAC;;AAEhB,SAAK,IAAI,SAAS,IAAI,MAAK,MAAM,EAAE;AAClC,WAAM,CAAC,MAAK,eAAe,CAAC,SAAS,CAAC,CAAC,GAAG,SAAS,CAAC;KACpD;;AAED,UAAM,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,EAAE,MAAM,EAAN,MAAM,EAAE,CAAC,CAAC;IACvC,CAAC,CAAC;;AAEH,SAAM,CAAC,EAAE,CAAC,YAAY,EAAE,YAAM;AAC7B,UAAK,YAAY,CAAC,MAAM,CAAC,CAAC;AAC1B,UAAK,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,WAAW,CAAC,EAAE,MAAM,CAAC,CAAC;IACjD,CAAC,CAAC;GACH,CAAC,CAAC;;AAEH,MAAI,CAAC,QAAQ,GAAG;AACf,OAAI,EAAK,6BAAU,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC;AAC5C,UAAO,EAAE,gCAAa,IAAI,EAAE,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC;GAClD,CAAC;;;;;;;;;AASF,MAAI,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;EACxB;;AAED,KAAI,EAAE,GAAG;AACR,SAAO,IAAI,CAAC,GAAG,CAAC;EAChB;;AAED,KAAI,KAAK,GAAG;AACX,SAAO,IAAI,CAAC,QAAQ,CAAC;EACrB;;AAED,gBAAe,CAAC,WAAW,EAAE;AAC5B,MAAI,CAAC,WAAW,CAAC,KAAK,EAAE;AACvB,qBAAM,qCAAqC,CAAC,CAAC;AAC7C,UAAO,IAAI,CAAC;GACZ;;AAED,0BAAE,UAAU,CAAC,WAAW,CAAC,GACtB,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,KAAK,EAAE,WAAW,CAAC,GACxC,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,KAAK,EAAE,IAAI,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC;;AAGtD,SAAO,IAAI,CAAC;EACZ;;AAED,IAAG,CAAC,IAAI,EAAE;AACT,MAAI,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;EAC9E;;AAED,KAAI,CAAC,IAAI,EAAE;AACV,MAAI,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE;AAC7B,OAAI,CAAC,YAAY,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE,CAAC;GAChD;;AAED,OAAK,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;;AAExG,SAAO,IAAI,CAAC;EACZ;;AAED,IAAG,CAAC,IAAI,EAAE;AACT,MAAI,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,EAAE;AAC7B,OAAI,CAAC,YAAY,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE,CAAC;GAChD;;AAED,OAAK,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;;AAEvG,SAAO,IAAI,CAAC;EACZ;;AAED,MAAK,CAAC,IAAI,EAAE,GAAG,EAAE;AAChB,MAAI,EAAE,IAAI,IAAI,IAAI,CAAC,YAAY,CAAA,AAAC,EAAE;AACjC,qBAAM,uBAAuB,CAAC,CAAC;AAC/B,UAAO,IAAI,CAAC;GACZ;;AAED,MAAI,KAAK,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;;AAE/C,MAAI,KAAK,KAAK,CAAC,CAAC,EAAE;AACjB,OAAI,CAAC,YAAY,CAAC,GAAG,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;GACvC,MAAM;AACN,qBAAM,6CAA6C,CAAC,CAAA;GACpD;;AAED,SAAO,IAAI,CAAC;EACZ;;AAED,OAAM,CAAC,IAAI,EAAE,GAAG,EAAE;AACjB,MAAI,EAAE,IAAI,IAAI,IAAI,CAAC,YAAY,CAAA,AAAC,EAAE;AACjC,qBAAM,wBAAwB,CAAC,CAAC;AAChC,UAAO,IAAI,CAAC;GACZ;;AAED,MAAI,KAAK,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;;AAEhD,MAAI,KAAK,KAAK,CAAC,CAAC,EAAE;AACjB,OAAI,CAAC,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;GACxC,MAAM;AACN,qBAAM,wCAAwC,CAAC,CAAA;GAC/C;;AAED,SAAO,IAAI,CAAC;EACZ;;AAED,cAAa,CAAC,IAAI,EAAE,IAAI,EAAE;AACzB,MAAI,UAAU,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,GAAG,GAAG,EAAE,CAAC;;AAE5E,SAAO,KAAK,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,EAAE,IAAI,CAAC,SAClC,CAAC,UAAU,KAAK,EAAE;AACvB,qBAAM,KAAK,CAAC,CAAC;GACb,CAAC,CAAC;EACJ;;AAED,eAAc,CAAC,IAAI,EAAE,IAAI,EAAE;AAC1B,MAAI,UAAU,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,IAAI,GAAG,EAAE,CAAC;;AAE7E,SAAO,KAAK,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,EAAE,IAAI,CAAC,SAClC,CAAC,UAAU,KAAK,EAAE;AACvB,qBAAM,KAAK,CAAC,CAAC;GACb,CAAC,CAAC;EACJ;;AAED,OAAM,CAAC,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE;;;AAC1B,MAAI,OAAO,GAAG,SAAV,OAAO,CAAI,OAAO,EAAE,MAAM,EAAK;;AAElC,OAAI,EAAE,IAAI,IAAI,OAAK,MAAM,CAAA,AAAC,EAAE;AAC3B,WAAO,MAAM,EAAE,CAAC;IAChB;;AAED,QAAK,CAAC,IAAI,CAAC,OAAK,MAAM,CAAC,IAAI,CAAC,UAAQ,MAAM,EAAE,IAAI,CAAC,CAC/C,IAAI,CAAC,YAAY;AACjB,WAAO,CAAC,GAAG,CAAC,aAAa,CAAC,CAAA;IAC1B,CAAC,SACI,CAAC,UAAU,KAAK,EAAE;AACvB,sBAAM,KAAK,CAAC,CAAC;AACb,UAAM,CAAC,KAAK,CAAC,CAAC;IACd,CAAC,CAAC;GACJ,CAAC;;AAEF,SAAO,IAAI,OAAO,CAAC,OAAO,CAAC,CAAC;EAC5B;;AAED,SAAQ,CAAC,IAAI,EAAE;AACd,MAAI,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;;AAErC,MAAI,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,EAAE;AAC5B,OAAI,CAAC,MAAM,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC;GAC5B;;AAED,OAAK,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;;AAElG,SAAO,IAAI,CAAC;EACZ;;AAED,YAAW,CAAC,IAAI,EAAE;AACjB,MAAI,SAAS,GAAG,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;;AAEzD,MAAI,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE;AACvB,OAAI,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC;GACvB;;AAED,WAAS,CAAC,OAAO,CAAC,UAAU,QAAQ,EAAE;AACrC,OAAI,OAAO,YAAA,CAAC;;AAEZ,OAAI,CAAC,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAA,KAAM,CAAC,CAAC,EAAE;AAC3D,QAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;IACrC;GACD,CAAC,CAAC;;AAEH,SAAO,IAAI,CAAC;EACZ;;AAED,UAAS,CAAC,IAAI,EAAE;;;AACf,MAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,YAAY,CAAC,EAAE;;AACvC,QAAI,MAAM,GAAG,OAAK,QAAQ,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;;AAEhD;QAAO,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,UAAU,SAAS,EAAE;AACjD,aAAO,MAAM,GAAG,SAAS,CAAC,WAAW,EAAE,CAAC;MACxC,CAAC;MAAC;;;;GACH;;AAED,SAAO,IAAI,CAAC;EACZ;;AAED,gBAAe,CAAC,IAAI,EAAE;AACrB,MAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,YAAY,CAAC,EAAE;AACvC,OAAI,MAAM,GAAG,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;;AAEhD,UAAO,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC,OAAO,CAAC,OAAO,EAAE,UAAU,SAAS,EAAE;AACrE,WAAO,SAAS,CAAC,WAAW,EAAE,CAAC;IAC/B,CAAC,CAAC;GACH;;AAED,SAAO,IAAI,CAAC;EACZ;;AAED,iBAAgB,CAAC,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE;AACvC,SAAO,MAAM,IAAK,MAAM,CAAC,IAAI,KAAK,IAAI,AAAC,IAAI,MAAM,CAAC,WAAW,CAAC,IAAI,IAAI,EAAE,CAAC;EACzE;;AAED,aAAY,CAAC,MAAM,EAAE;AACpB,SAAO,MAAM,CAAC,IAAI,CAAC;AACnB,SAAO,MAAM,CAAC,WAAW,CAAC,CAAC;EAC3B;;AAED,QAAO,CAAC,EAAE,EAAE;;;AACX,SAAO,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM,EAAK;AACvC,OAAI,MAAM,CAAC,WAAW,IAAI,OAAK,QAAQ,EAAE,EAExC,MAAM;AACN,WAAK,KAAK,CAAC,IAAI,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,UAAC,IAAI,EAAK;AAC3C,YAAO,CAAC,IAAI,CAAC,CAAC;KACd,CAAC,SAAM,CAAC,MAAM,CAAC,CAAC;IACjB;GACD,CAAC,CAAC;EACH;;CAGD;;qBAEc,UAAU","file":"baseClient.js","sourcesContent":["import IO               from 'socket.io';\nimport EventEmitter     from 'events';\nimport _                from 'underscore';\nimport deepExtend       from 'deep-extend';\nimport { debug }        from './debug';\nimport ChatModel        from './models/chat';\nimport MessageModel     from './models/message';\nimport Members          from './members';\nimport Rooms            from './rooms';\nimport Memory           from './memory';\nimport Db               from './db/index';\nimport * as chain        from './chain';\nimport * as middleWares from './middlewares';\nimport * as OPTION      from './options';\nimport * as EVENT       from './events';\n\nrequire('source-map-support').install();\n\nvar typeOf = function (object) {\n\treturn Object.prototype.toString.call(object).replace(/\\[object\\s(\\w+)\\]/, '$1');\n};\n\nconst IO_CONNECTION = 'connection';\nconst SOCKET_USER   = 'user';\n\nclass BaseClient extends EventEmitter {\n\tconstructor(server, options = {}) {\n\t\tsuper();\n\n\t\tif (!server) {\n\t\t\tthrow new Error('first argument required `http` server');\n\t\t}\n\n\t\tif (!options.db) {\n\t\t\tthrow new Error('options required `db` section');\n\t\t}\n\n\t\tif (!options.db.connect) {\n\t\t\tthrow new Error('options.db required `connect`');\n\t\t}\n\n\t\tif (!options.db.provider) {\n\t\t\tthrow new Error('options.db required `provider` (mongodb)');\n\t\t}\n\n\t\tthis.__middleware = [];\n\t\tthis._options     = _.clone(options);\n\t\tthis._io          = IO(server, deepExtend({ maxHttpBufferSize: 1000 }, this._options[OPTION.IO] || {}));\n\t\tthis.EVENTS       = Object.create(null);\n\t\tthis.rooms        = new Rooms();\n\t\tthis.members      = new Members();\n\t}\n\n\tinitialize() {\n\t\tthis.emit('pre-initialize');\n\n\t\tthis._db = new Db(this._options.db);\n\t\tthis._io.on(IO_CONNECTION, (socket) => {\n\t\t\tlet _client = this;\n\n\t\t\tlet wrapEventCallback = function (event, socket, data) {\n\t\t\t\t_client.invoke(event, socket, data);\n\t\t\t};\n\n\t\t\tfor (let name in this.EVENTS) {\n\t\t\t\tlet eventName = name;\n\n\t\t\t\tsocket.on(eventName, (function (event) {\n\t\t\t\t\treturn function (data = {}) {\n\t\t\t\t\t\twrapEventCallback(event, socket, data)\n\t\t\t\t\t};\n\t\t\t\t}(eventName)));\n\t\t\t}\n\n\t\t\tsocket.on('error', function (error) {\n\t\t\t\tconsole.log(error.stack);\n\t\t\t});\n\n\t\t\tsocket.on(EVENT.OPTIONS, () => {\n\t\t\t\tlet events = {};\n\n\t\t\t\tfor (let eventName in this.EVENTS) {\n\t\t\t\t\tevents[this.revertEventName(eventName)] = eventName;\n\t\t\t\t}\n\n\t\t\t\tsocket.emit(EVENT.OPTIONS, { events });\n\t\t\t});\n\n\t\t\tsocket.on('disconnect', () => {\n\t\t\t\tthis.logoutSocket(socket);\n\t\t\t\tthis.members.remove(socket[SOCKET_USER], socket);\n\t\t\t});\n\t\t});\n\n\t\tthis.__models = {\n\t\t\tChat:    ChatModel(this, this._options.chat),\n\t\t\tMessage: MessageModel(this, this._options.message)\n\t\t};\n\n\t\t//if (this._options[OPTION.CHAT_MEMORY]) {\n\t\t//\tthis._memoryChat = new Memory({\n\t\t//\t\tprovider: this._options[OPTION.CHAT_MEMORY_PROVIDER],\n\t\t//\t\tttl:      this._options[OPTION.CHAT_MEMORY_TTL]\n\t\t//\t});\n\t\t//}\n\n\t\tthis.emit('initialize');\n\t}\n\n\tget io() {\n\t\treturn this._io;\n\t}\n\n\tget model() {\n\t\treturn this.__models;\n\t}\n\n\tapplyMiddleware(_Middleware) {\n\t\tif (!_Middleware.event) {\n\t\t\tdebug('middleware not specified event name');\n\t\t\treturn this;\n\t\t}\n\n\t\t_.isFunction(_Middleware)\n\t\t\t? this.use(_Middleware.event, _Middleware)\n\t\t\t: this.use(_Middleware.event, new _Middleware(this));\n\n\n\t\treturn this;\n\t}\n\n\tpre(path) {\n\t\tthis.use.apply(this, [path].concat(Array.prototype.slice.call(arguments, 1)));\n\t}\n\n\tpost(path) {\n\t\tif (!this.__middleware[path]) {\n\t\t\tthis.__middleware[path] = { pre: [], post: [] };\n\t\t}\n\n\t\tchain.add.apply(chain, [this.__middleware[path].post].concat(Array.prototype.slice.call(arguments, 1)));\n\n\t\treturn this;\n\t}\n\n\tuse(path) {\n\t\tif (!this.__middleware[path]) {\n\t\t\tthis.__middleware[path] = { pre: [], post: [] };\n\t\t}\n\n\t\tchain.add.apply(chain, [this.__middleware[path].pre].concat(Array.prototype.slice.call(arguments, 1)));\n\n\t\treturn this;\n\t}\n\n\tunUse(path, obj) {\n\t\tif (!(path in this.__middleware)) {\n\t\t\tdebug('unUse: path not found');\n\t\t\treturn this;\n\t\t}\n\n\t\tlet index = this.__middleware.pre.indexOf(obj);\n\n\t\tif (index !== -1) {\n\t\t\tthis.__middleware.pre.splice(index, 1);\n\t\t} else {\n\t\t\tdebug('unuse: not found callback, already removed?')\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tunPost(path, obj) {\n\t\tif (!(path in this.__middleware)) {\n\t\t\tdebug('unPost: path not found');\n\t\t\treturn this;\n\t\t}\n\n\t\tlet index = this.__middleware.post.indexOf(obj);\n\n\t\tif (index !== -1) {\n\t\t\tthis.__middleware.post.splice(index, 1);\n\t\t} else {\n\t\t\tdebug('unuse: not found obj, already removed?')\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tpreMiddleware(path, data) {\n\t\tvar middleware = this.__middleware[path] ? this.__middleware[path].pre : [];\n\n\t\treturn chain.exec(middleware, this, data)\n\t\t\t.catch(function (error) {\n\t\t\t\tdebug(error);\n\t\t\t});\n\t}\n\n\tpostMiddleware(path, data) {\n\t\tvar middleware = this.__middleware[path] ? this.__middleware[path].post : [];\n\n\t\treturn chain.exec(middleware, this, data)\n\t\t\t.catch(function (error) {\n\t\t\t\tdebug(error);\n\t\t\t});\n\t}\n\n\tinvoke(name, socket, data) {\n\t\tlet promise = (resolve, reject) => {\n\n\t\t\tif (!(name in this.EVENTS)) {\n\t\t\t\treturn reject();\n\t\t\t}\n\n\t\t\tchain.exec(this.EVENTS[name], this, socket, data)\n\t\t\t\t.then(function () {\n\t\t\t\t\tconsole.log('then invoke')\n\t\t\t\t})\n\t\t\t\t.catch(function (error) {\n\t\t\t\t\tdebug(error);\n\t\t\t\t\treject(error);\n\t\t\t\t});\n\t\t};\n\n\t\treturn new Promise(promise);\n\t}\n\n\taddEvent(name) {\n\t\tvar eventName = this.eventName(name);\n\n\t\tif (!this.EVENTS[eventName]) {\n\t\t\tthis.EVENTS[eventName] = [];\n\t\t}\n\n\t\tchain.add.apply(chain, [this.EVENTS[eventName]].concat(Array.prototype.slice.call(arguments, 1)));\n\n\t\treturn this;\n\t}\n\n\tremoveEvent(name) {\n\t\tvar callbacks = Array.prototype.slice.call(arguments, 1);\n\n\t\tif (!this.EVENTS[name]) {\n\t\t\tthis.EVENTS[name] = [];\n\t\t}\n\n\t\tcallbacks.forEach(function (callback) {\n\t\t\tlet indexCb;\n\n\t\t\tif ((indexCb = this.EVENTS[name].indexOf(callback)) !== -1) {\n\t\t\t\tthis.EVENTS[name].splice(indexCb, 1);\n\t\t\t}\n\t\t});\n\n\t\treturn this;\n\t}\n\n\teventName(name) {\n\t\tif (this._options[OPTION.EVENT_PREFIX]) {\n\t\t\tlet prefix = this._options[OPTION.EVENT_PREFIX];\n\n\t\t\treturn name.replace(/^(\\w)/, function (firstChar) {\n\t\t\t\treturn prefix + firstChar.toUpperCase();\n\t\t\t});\n\t\t}\n\n\t\treturn name;\n\t}\n\n\trevertEventName(name) {\n\t\tif (this._options[OPTION.EVENT_PREFIX]) {\n\t\t\tlet prefix = this._options[OPTION.EVENT_PREFIX];\n\n\t\t\treturn name.replace(prefix, '').replace(/^(\\w)/, function (firstChar) {\n\t\t\t\treturn firstChar.toLowerCase();\n\t\t\t});\n\t\t}\n\n\t\treturn name;\n\t}\n\n\tsocketAuthorized(socket, options, next) {\n\t\treturn socket && (socket.auth === true) && socket[SOCKET_USER] && next();\n\t}\n\n\tlogoutSocket(socket) {\n\t\tdelete socket.auth;\n\t\tdelete socket[SOCKET_USER];\n\t}\n\n\tgetChat(id) {\n\t\treturn new Promise((resolve, rejcet) => {\n\t\t\tif (OPTION.CHAT_MEMORY in this._options) {\n\n\t\t\t} else {\n\t\t\t\tthis.model.Chat.findById(id).then((chat) => {\n\t\t\t\t\tresolve(chat);\n\t\t\t\t}).catch(reject);\n\t\t\t}\n\t\t});\n\t}\n\n\n}\n\nexport default BaseClient;"]}