{"version":3,"sources":["../../src/model/model.es6"],"names":[],"mappings":"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","file":"model.js","sourcesContent":["import { debug }     from '../debug';\nimport clone         from 'clone';\nimport deepExtend     from 'deep-extend';\nimport QueryResolver from '../queryResolver';\nimport SchemaLoader  from '../schema';\n\nexport default class Model {\n\tconstructor() {\n\n\t}\n\n\tinitialize(options = {}) {\n\t\tthis.defaults(this.schema());\n\t\tthis.readOnly(this.schema());\n\t}\n\n\tstatic ensureIndex() {\n\t\tSchemaLoader\n\t\t\t.index(this.schema())\n\t\t\t.forEach(function (value, index) {\n\t\t\t\tthis.db().connect.collection(this.collection()).ensureIndex(index, value, function (err, result) {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tdebug('ensure index: ' + err.message);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t}\n\n\tset defaults(schema) {\n\t\tthis._defaults = SchemaLoader.defaults(schema);\n\t}\n\n\tget defaults() {\n\t\treturn this._defaults;\n\t}\n\n\tset readOnly(schema) {\n\t\tthis._readOnly = SchemaLoader.readOnly(schema);\n\t}\n\n\tget readOnly() {\n\t\treturn this._readOnly;\n\t}\n\n\tset(key, value, path = []) {\n\t\tif (arguments.length === 1) {\n\t\t\t_.each(key, (value, key) => {\n\t\t\t\tthis.set(key, value, path.push(key));\n\t\t\t});\n\t\t} else {\n\t\t\tpath = [key];\n\t\t}\n\n\t\tif (~this.defaults.indexOf(key) && !~this.readOnly.indexOf(path.join('.'))) {\n\t\t\tthis[key] = value;\n\n\t\t\tif (~['Number', 'String', 'Data', 'Boolean', 'Object', 'Null'].indexOf(typeOf(value))) {\n\t\t\t\tthis.__addAtomic('set', key, value);\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\tget(key) {\n\t\tif (~this.defaults.indexOf(key)) {\n\t\t\treturn this[key];\n\t\t}\n\t}\n\n\tfill(key, value, isAtomic = false) {\n\t\tif (_.isBoolean(arguments[1])) {\n\t\t\t_.each(key, (value, key1) => {\n\t\t\t\tthis.fill(key1, value);\n\t\t\t});\n\t\t}\n\n\t\tif (~this.defaults.indexOf(key)) {\n\t\t\tthis[key] = value;\n\n\t\t\tif (isAtomic) {\n\t\t\t\tthis.__addAtomic('set', key, value);\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\ttoJSON() {\n\t\tlet output = {};\n\n\t\tfor (let prop in this) {\n\t\t\tif (this.hasOwnProperty(prop)) {\n\t\t\t\toutput[prop] = this[prop];\n\t\t\t}\n\t\t}\n\n\t\treturn clone(output, true);\n\t}\n\n\tstatic find() {\n\t\tlet queryResolver = new QueryResolver(Model);\n\n\t\treturn queryResolver.find.apply(queryResolver, arguments);\n\t}\n\n\tstatic findOne() {\n\t\tlet queryResolver = new QueryResolver(Model);\n\n\t\treturn queryResolver.findOne.apply(queryResolver, arguments);\n\t}\n}"]}