{"version":3,"sources":["../src/schema.es6"],"names":[],"mappings":"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","file":"schema.js","sourcesContent":["import fs from 'fs';\nimport _  from 'underscore';\n\nclass SchemaLoader {\n\tstatic load(schemaPath) {\n\t\tvar schema = fs.readFileSync(schemaPath);\n\n\t\treturn schema ? JSON.parse(schema) : null;\n\t}\n\n\tstatic defaults(schema) {\n\t\tvar output = {};\n\n\t\tvar walker = function (props, output) {\n\t\t\t_.each(props, function (prop, key) {\n\t\t\t\tif (prop.properties) {\n\t\t\t\t\toutput[key] = {};\n\t\t\t\t}\n\n\t\t\t\tif (prop.default) {\n\t\t\t\t\tif (_.isObject(prop.default) && prop.default.type) {\n\n\t\t\t\t\t\toutput[key] = prop.default.value\n\t\t\t\t\t\t\t? global[prop.default.type](prop.default.value)\n\t\t\t\t\t\t\t: global[prop.default.type]();\n\n\t\t\t\t\t} else if (_.isString(prop.default)) {\n\t\t\t\t\t\toutput[key] = ~['null', 'undefined'].indexOf(prop.default)\n\t\t\t\t\t\t\t? null\n\t\t\t\t\t\t\t: global[prop.default]();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (prop.properties) {\n\t\t\t\t\twalker(prop.properties, output[key]);\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\twalker(schema.properties, output);\n\n\t\treturn output;\n\t}\n\n\tstatic index(schema) {\n\t\tlet list = [],\n\t\t\titerations = 0,\n\t\t\tlimitIterations = 200;\n\n\t\tlet walker = function (props, path = []) {\n\t\t\tif (iterations > limitIterations) {\n\t\t\t\tthrow new Error('recursive walk schema for index')\n\t\t\t}\n\n\t\t\t_.each(props, function (props, key) {\n\t\t\t\tif (prop.index) {\n\t\t\t\t\t// TODO: if nested properties?\n\t\t\t\t\tpath.push(key);\n\t\t\t\t\tlist.push({\n\t\t\t\t\t\t[path.join('.')]: prop.index\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\tif (prop.properties) {\n\t\t\t\t\tpath.push(key);\n\t\t\t\t\titerations++;\n\t\t\t\t\twalker(prop.properties, path)\n\t\t\t\t}\n\n\t\t\t\tif (prop.items && prop.items.properties) {\n\t\t\t\t\tpath.push(key);\n\t\t\t\t\titerations++;\n\t\t\t\t\twalker(prop.items.properties, path);\n\t\t\t\t}\n\t\t\t});\n\t\t};\n\n\t\twalker(schema.properties);\n\n\t\treturn list;\n\t}\n\n\tstatic readOnly(schema){\n\t\tvar readonlyAttrs = [];\n\t\tvar path          = [];\n\n\t\tfunction walk(properties) {\n\t\t\t_.each(properties, (prop, key) => {\n\t\t\t\tpath.push(key);\n\n\t\t\t\tif (prop.readonly) {\n\t\t\t\t\treadonlyAttrs.push(path.join('.'));\n\t\t\t\t}\n\n\t\t\t\tif (prop.properties) {\n\t\t\t\t\twalk(prop.properties);\n\t\t\t\t} else {\n\t\t\t\t\tpath = [];\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\twalk(schema.properties);\n\n\t\treturn readonlyAttrs;\n\t}\n}\n\nexport default SchemaLoader;"]}