{"version":3,"sources":["/home/demitriy/work/chat/lib/chat.js"],"names":[],"mappings":"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","file":"chat-compiled.js","sourcesContent":["'use strict';\n\nvar _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();\n\nvar _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { desc = parent = getter = undefined; _again = false; var object = _x,\n    property = _x2,\n    receiver = _x3; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) subClass.__proto__ = superClass; }\n\nvar _ = require('lodash'),\n    util = require('util'),\n    db = require('./db'),\n    SchemaLoader = require('./schema'),\n    Model = require('./model'),\n    schemaLoader = new SchemaLoader(),\n    schema = schemaLoader.load(__dirname + '/../schema/chat.json');\n\nvar sl = Array.prototype.slice;\n\nmodule.exports = function (options) {\n\tvar collectionName;\n\n\tcollectionName = options.collection || 'chats';\n\n\tvar Chat = (function (_Model) {\n\t\tfunction Chat(props) {\n\t\t\t_classCallCheck(this, Chat);\n\n\t\t\t_get(Object.getPrototypeOf(Chat.prototype), 'constructor', this).call(this, props);\n\n\t\t\tthis.setSchema(schema);\n\n\t\t\tthis.on('beforeValidate', function () {\n\t\t\t\tif (!this.get('createdAt')) {\n\t\t\t\t\tthis.set('createdAt', new Date());\n\t\t\t\t}\n\n\t\t\t\tthis.set('type', this.determinateType());\n\t\t\t});\n\t\t}\n\n\t\t_inherits(Chat, _Model);\n\n\t\t_createClass(Chat, [{\n\t\t\tkey: 'defaults',\n\t\t\tvalue: function defaults() {\n\t\t\t\treturn {\n\t\t\t\t\t_id: null,\n\t\t\t\t\tname: '',\n\t\t\t\t\ttitle: '',\n\t\t\t\t\tcreatorId: null,\n\t\t\t\t\tmembers: [],\n\t\t\t\t\tcreatedAt: null,\n\t\t\t\t\ttype: 'private',\n\t\t\t\t\tsystemMessages: {\n\t\t\t\t\t\taddMember: false,\n\t\t\t\t\t\tremoveMember: false,\n\t\t\t\t\t\tchangeTitle: false\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'setCreator',\n\t\t\tvalue: function setCreator(id) {\n\t\t\t\tif (db.ObjectID.isValid(id)) {\n\t\t\t\t\tthis.set('creatorId', id);\n\t\t\t\t\tthis.addMember(id);\n\t\t\t\t}\n\n\t\t\t\treturn this;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'addMember',\n\t\t\tvalue: function addMember(id) {\n\t\t\t\tif (db.ObjectID.isValid(id)) {\n\t\t\t\t\tvar index = this.indexMember(id);\n\n\t\t\t\t\tif (index === -1) {\n\t\t\t\t\t\tthis.get('members').push(id);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn this;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'removeMember',\n\t\t\tvalue: function removeMember(id) {\n\t\t\t\tvar index = this.indexMember(id);\n\n\t\t\t\tthis.get('members').splice(index, 1);\n\n\t\t\t\treturn this;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'indexMember',\n\t\t\tvalue: function indexMember(id) {\n\t\t\t\tvar index = -1;\n\n\t\t\t\tthis.get('members').forEach(function (member, key) {\n\t\t\t\t\tif (member.equals(id)) {\n\t\t\t\t\t\tindex = key;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn index;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'collection',\n\t\t\tvalue: function collection() {\n\t\t\t\treturn collectionName;\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'determinateType',\n\t\t\tvalue: function determinateType() {\n\t\t\t\tif (this.get('members').length <= 2) {\n\t\t\t\t\treturn 'private';\n\t\t\t\t}\n\n\t\t\t\tif (this.get('members').length > 2) {\n\t\t\t\t\treturn 'group';\n\t\t\t\t}\n\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}], [{\n\t\t\tkey: 'findById',\n\t\t\tvalue: function findById(id) {\n\t\t\t\tvar chatId = db.ObjectId(id);\n\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\tdb.getConnect(function (connect) {\n\t\t\t\t\t\tconnect.collection(collectionName).findOne({ _id: chatId }, function (error, result) {\n\t\t\t\t\t\t\treturn error ? reject(error) : result ? resolve(new Chat().set(result)) : resolve(result);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'findByOwner',\n\t\t\tvalue: function findByOwner(id, creatorId) {\n\t\t\t\tvar chatId, chatCreatorId, criteria;\n\n\t\t\t\tchatId = db.ObjectId(id);\n\t\t\t\tchatCreatorId = db.ObjectId(creatorId);\n\n\t\t\t\tcriteria = { _id: chatId, creatorId: chatCreatorId };\n\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\tdb.getConnect(function (connect) {\n\t\t\t\t\t\tconnect.collection(collectionName).findOne(criteria, function (error, result) {\n\t\t\t\t\t\t\treturn error ? reject(error) : result ? resolve(new Chat().set(result)) : resolve(result);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'findByMember',\n\t\t\tvalue: function findByMember(id, memberId) {\n\t\t\t\tvar chatId, chatMemberId, criteria;\n\n\t\t\t\tchatId = db.ObjectId(id);\n\t\t\t\tchatMemberId = db.ObjectId(memberId);\n\n\t\t\t\tcriteria = { _id: chatId, members: chatMemberId };\n\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\tdb.getConnect(function (connect) {\n\t\t\t\t\t\tconnect.collection(collectionName).findOne(criteria, function (error, result) {\n\t\t\t\t\t\t\treturn error ? reject(error) : result ? resolve(new Chat().set(result)) : resolve(result);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}, {\n\t\t\tkey: 'findAllByMember',\n\t\t\tvalue: function findAllByMember(memberId) {\n\t\t\t\tvar chatMemberId, criteria;\n\n\t\t\t\tchatMemberId = db.ObjectId(memberId);\n\n\t\t\t\tcriteria = { members: chatMemberId };\n\n\t\t\t\treturn new Promise(function (resolve, reject) {\n\t\t\t\t\tdb.getConnect(function (connect) {\n\t\t\t\t\t\tconnect.collection(collectionName).find(criteria).toArray(function (error, result) {\n\t\t\t\t\t\t\treturn error ? reject(error) : resolve(result);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t}]);\n\n\t\treturn Chat;\n\t})(Model);\n\n\treturn Chat;\n};"]}